<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="Trying to be the person you want to be.">
    

    <!--Author-->
    
        <meta name="author" content="TIGERB">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="ç”±æµ…åˆ°æ·±ï¼Œå…¥é—¨Goè¯­è¨€Mapå®ç°åŸç†"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="TIGERB"/>

    <!--Page Cover-->
    
        <meta property="og:image" content="undefined"/>
    

    <!-- Title -->
    
    <title>ç”±æµ…åˆ°æ·±ï¼Œå…¥é—¨Goè¯­è¨€Mapå®ç°åŸç† - TIGERB</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/sass/main.css">

    <!--[if lt IE 8]>
        <script src="/js/ie/html5shiv.js"></script>
    <![endif]-->

    <!--[if lt IE 8]>
        <link rel="stylesheet" href="/sass/ie8.css">
    <![endif]-->

    <!--[if lt IE 9]>
        <link rel="stylesheet" href="/sass/ie9.css">
    <![endif]-->

    <!-- Gallery -->
    <link href="https://cdn.bootcss.com/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?30c7e7d53256334a8dc1cf524fcc77f6";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
    })();
    </script>

</head>

<body>

    <div id="wrapper">

        <!-- Menu -->
        <!-- Header -->
<header id="header">
    <div class="inner">

        <!-- Logo -->
        <a href="/" class="logo">
            <span class="symbol"><img src="http://cdn.tigerb.cn/20190707142019.png" alt="" /></span><span class="title">TIGERB</span>
        </a>

        <!-- Nav -->
        <nav>
            <ul>
                <li><a href="#menu">Menu</a></li>
            </ul>
        </nav>

    </div>
</header>

<!-- Menu -->
<nav id="menu">
    <h2>Menu</h2>
    <ul>
        
            <li>
                <a href="/">é¦–é¡µ</a>
            </li>
        
            <li>
                <a href="https://github.com/TIGERB">Github</a>
            </li>
        
            <li>
                <a href="https://segmentfault.com/u/tigerb">Segmentfault</a>
            </li>
        
            <li>
                <a href="https://juejin.im/user/5855e82d1b69e6006c9278b4">æ˜é‡‘</a>
            </li>
        
    </ul>
</nav>


        <div id="main">
            <div class="inner">

                <!-- Main Content -->
                

    <h1 class="title">ç”±æµ…åˆ°æ·±ï¼Œå…¥é—¨Goè¯­è¨€Mapå®ç°åŸç†</h1>
    <div class="meta">
        2020-12-20
    </div>


    <span class="image main"><img src="http://cdn.tigerb.cn/20201220215334.jpg?imageMogr2/thumbnail/1500x1000!/format/webp/blur/1x0/quality/75|imageslim" alt="" /></span>


<!-- Gallery -->


<!-- Content -->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/css/lightgallery.min.css"><div class=".article-gallery" <p=""><span><p></p>
<blockquote>
<p>Goæºç ç‰ˆæœ¬1.13.8</p>
</blockquote>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><hr>
<blockquote>
<p>å†™åšå®¢çš„ç›®çš„ï¼Ÿ</p>
</blockquote>
<p>æŠŠè‡ªå·±å­¦ä¹ çŸ¥è¯†è¿›è¡Œä¸€ä¸ªæ€»ç»“ã€‚åŒæ—¶æŠŠä¸€äº›å¯èƒ½å›°éš¾ã€å¤æ‚éš¾ä»¥ç†è§£çš„ä¸œè¥¿è‡ªæˆ‘æ¶ˆåŒ–å¸æ”¶åï¼Œç®€å•åŒ–è¾“å‡ºï¼Œé™ä½ä»–äººçš„å­¦ä¹ æˆæœ¬ï¼Œæé«˜ä»–äººçš„å­¦ä¹ æ•ˆç‡ï¼Œä¸»è¦ä¸ºå¦‚ä¸‹ä¸¤ç‚¹ï¼š</p>
<ul>
<li>è‡ªæˆ‘å­¦ä¹ çš„æ€»ç»“è¿‡ç¨‹</li>
<li>ç®€åŒ–ä»–äººå­¦ä¹ æˆæœ¬çš„ç»“æœ</li>
</ul>
<p>å…¶æ¬¡ï¼Œæˆ–å¤šæˆ–å°‘å­˜åœ¨è‡ªå·±å­¦ä¹ è¿‡ç¨‹ä¸­ç†è§£ä¸åˆ°ä½æˆ–è€…é”™è¯¯çš„åœ°æ–¹å¸Œæœ›å¤§å®¶å¯èƒ½åŠæ—¶å¸®æˆ‘çº æ­£ï¼Œæ„Ÿè°¢ä»¥åŠè¯´ä¸€å£°æŠ±æ­‰ã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆåšå®¢æ›´æ–°çš„è¿™ä¹ˆæ…¢ï¼Ÿ</p>
</blockquote>
<ul>
<li>å­¦ä¹ çš„éš¾åº¦åœ¨ä¸æ–­çš„å¢åŠ ï¼Œäº§å‡ºè¶Šæ¥è¶Šæ…¢</li>
<li>æ¯”ä»¥å‰æ‡’äº†ï¼Ÿ</li>
</ul>
<p>ä»Šå¤©è¦åˆ†äº«çš„æ˜¯ä¸»è¦å†…å®¹æ˜¯<code>Goè¯­è¨€Mapåº•å±‚å®ç°</code>ï¼Œç›®çš„è®©å¤§å®¶å¿«é€Ÿäº†è§£<code>Goè¯­è¨€Map</code>åº•å±‚å¤§è‡´çš„å®ç°åŸç†ã€‚è¯»å®Œæœ¬ç¯‡æ–‡ç« ä½ å¯ä»¥è·å¾—æ”¶ç›Šã€ä»¥åŠæˆ‘æ‰€æœŸæœ›ä½ èƒ½è·å–çš„æ”¶ç›Šå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ”¶ç›Šåºå·</th>
<th>æ”¶ç›Šæè¿°</th>
<th>æŒæ¡ç¨‹åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ”¶ç›Š1</td>
<td><strong>å¤§è‡´</strong>å¯¹Goè¯­è¨€Mapåº•å±‚å®ç°æœ‰ä¸€ä¸ªäº†è§£</td>
<td>å¿…é¡»æŒæ¡</td>
</tr>
<tr>
<td>æ”¶ç›Š2</td>
<td><strong>å¤§è‡´çŸ¥é“</strong>Goè¯­è¨€Mapæ˜¯å¦‚ä½•è¯»å–æ•°æ®çš„</td>
<td>å¿…é¡»æŒæ¡</td>
</tr>
<tr>
<td>æ”¶ç›Š3</td>
<td><strong>ç†Ÿæ‚‰</strong>Goè¯­è¨€Mapåº•å±‚æ ¸å¿ƒç»“æ„ä½“<code>hmap</code></td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>æ”¶ç›Š4</td>
<td><strong>ç†Ÿæ‚‰</strong>Goè¯­è¨€Mapåº•å±‚æ ¸å¿ƒç»“æ„ä½“<code>bmap</code></td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>æ”¶ç›Š5</td>
<td><strong>ç†Ÿæ‚‰</strong>Goè¯­è¨€Mapåº•å±‚é‡Œçš„æº¢å‡ºæ¡¶</td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>æ”¶ç›Š6</td>
<td><strong>ç†Ÿæ‚‰</strong>Goè¯­è¨€Mapæ˜¯å¦‚ä½•è¯»å–æ•°æ®çš„</td>
<td>å¯é€‰</td>
</tr>
</tbody>
</table>
<p>æ”¶ç›Š1å’Œæ”¶ç›Š2æ˜¯çœ‹äº†æœ¬ç¯‡æ–‡ç« å¸Œæœ›å¤§å®¶<strong>å¿…é¡»æŒæ¡</strong>çš„çŸ¥è¯†ç‚¹ï¼Œå…¶ä»–çš„ä¸ºå¯é€‰é¡¹ï¼Œå¦‚æœä½ å¯¹æ­¤æ„Ÿå…´è¶£æˆ–è€…å·²ç»æŒæ¡äº†æ”¶ç›Š1ã€2å¯ä»¥ç»§ç»­é˜…è¯»æ­¤å¤„çš„å†…å®¹ã€‚</p>
<p>å¯¹äºæœ¬ç¯‡æ–‡ç« çš„ç»“æ„ä¸»è¦æŒ‰å¦‚ä¸‹é¡ºåºå¼€å±•ï¼š</p>
<ul>
<li>ç®€å•çœ‹çœ‹ä¸€èˆ¬Mapçš„å®ç°æ€è·¯</li>
<li>Goè¯­è¨€é‡ŒMapçš„å®ç°æ€è·¯(å…¥é—¨ç¨‹åº¦ï¼šåŒ…å«æ”¶ç›Š1ã€2)</li>
<li>Goè¯­è¨€é‡ŒMapçš„å®ç°æ€è·¯(ç†Ÿæ‚‰ç¨‹åº¦ï¼šåŒ…å«æ”¶ç›Š3ã€4ã€5ã€6)</li>
</ul>
<p>å…¶æ¬¡ï¼Œæœ¬ç¯‡æ–‡ç« ä¸»è¦ä»¥<strong>Mapçš„è¯»</strong>æ¥å±•å¼€åˆ†æï¼Œå› ä¸ºè¯»å¼„æ˜ç™½äº†ï¼Œå…¶ä»–çš„å†™ã€æ›´æ–°ã€åˆ é™¤ç­‰åŸºæœ¬æ“ä½œåŸºæœ¬éƒ½å¯ä»¥çŒœå‡ºæ¥äº†ï¼Œä¸æ˜¯ä¹ˆğŸ˜ã€‚</p>
<h1 id="ç®€å•çœ‹çœ‹ä¸€èˆ¬Mapçš„å®ç°æ€è·¯"><a href="#ç®€å•çœ‹çœ‹ä¸€èˆ¬Mapçš„å®ç°æ€è·¯" class="headerlink" title="ç®€å•çœ‹çœ‹ä¸€èˆ¬Mapçš„å®ç°æ€è·¯"></a>ç®€å•çœ‹çœ‹ä¸€èˆ¬Mapçš„å®ç°æ€è·¯</h1><hr>
<p>ç›´å…¥ä¸»é¢˜ï¼Œä¸€èˆ¬çš„Mapä¼šåŒ…å«ä¸¤ä¸ªä¸»è¦ç»“æ„ï¼š</p>
<ul>
<li>æ•°ç»„ï¼šæ•°ç»„é‡Œçš„å€¼æŒ‡å‘ä¸€ä¸ªé“¾è¡¨</li>
<li>é“¾è¡¨ï¼šç›®çš„è§£å†³hashå†²çªçš„é—®é¢˜ï¼Œå¹¶å­˜æ”¾é”®å€¼</li>
</ul>
<p>å¤§è‡´ç»“æ„å¦‚ä¸‹ï¼š</p>
<p align="center"><br>  <a href="http://cdn.tigerb.cn/20201216161128.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201216161128.png" style="width:100%"></a><br></p>

<p>è¯»å–ä¸€ä¸ªkeyå€¼çš„è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                  key</span><br><span class="line">                   |</span><br><span class="line">                   v                 </span><br><span class="line">+------------------------------------+</span><br><span class="line">|      keyé€šè¿‡hashå‡½æ•°å¾—åˆ°keyçš„hash    |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">                   |</span><br><span class="line">                   v</span><br><span class="line">+------------------------------------+</span><br><span class="line">|       keyçš„hashé€šè¿‡å–æ¨¡æˆ–è€…ä½æ“ä½œ     |</span><br><span class="line">|          å¾—åˆ°keyåœ¨æ•°ç»„ä¸Šçš„ç´¢å¼•        |</span><br><span class="line">+------------------------------------+</span><br><span class="line">                   |</span><br><span class="line">                   v</span><br><span class="line">+------------------------------------+</span><br><span class="line">|         é€šè¿‡ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„é“¾è¡¨         |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">                   |</span><br><span class="line">                   v</span><br><span class="line">+------------------------------------+</span><br><span class="line">|       éå†é“¾è¡¨å¯¹æ¯”keyå’Œç›®æ ‡key        |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">                   |</span><br><span class="line">                   v</span><br><span class="line">+------------------------------------+</span><br><span class="line">|              ç›¸ç­‰åˆ™è¿”å›value         |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">                   |</span><br><span class="line">                   v                </span><br><span class="line">                 value</span><br></pre></td></tr></table></figure>
<p>æ¥ç€æˆ‘ä»¬æ¥ç®€å•çœ‹çœ‹Goè¯­è¨€é‡ŒMapçš„å®ç°æ€è·¯ã€‚</p>
<h1 id="Goè¯­è¨€é‡ŒMapçš„å®ç°æ€è·¯-å…¥é—¨ç¨‹åº¦"><a href="#Goè¯­è¨€é‡ŒMapçš„å®ç°æ€è·¯-å…¥é—¨ç¨‹åº¦" class="headerlink" title="Goè¯­è¨€é‡ŒMapçš„å®ç°æ€è·¯(å…¥é—¨ç¨‹åº¦)"></a>Goè¯­è¨€é‡ŒMapçš„å®ç°æ€è·¯(å…¥é—¨ç¨‹åº¦)</h1><hr>
<blockquote>
<p>åŒ…å«æ”¶ç›Š1ã€2</p>
</blockquote>
<p>Goè¯­è¨€è§£å†³hashå†²çªä¸æ˜¯é“¾è¡¨ï¼Œå®é™…<strong>ä¸»è¦</strong>ç”¨çš„æ•°ç»„(å†…å­˜ä¸Šçš„è¿ç»­ç©ºé—´)ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¤‡æ³¨ï¼šåé¢æˆ‘ä»¬ä¼šè§£é‡Šä¸Šé¢ä¸ºå•¥ç”¨çš„â€œä¸»è¦â€ä¸¤ä¸ªå­—ã€‚</span><br></pre></td></tr></table></figure>
<p align="center"><br>  <a href="http://cdn.tigerb.cn/20201219202458.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201219202458.png" style="width:60%"></a><br></p>

<p>ä½†æ˜¯å¹¶ä¸æ˜¯åªä½¿ç”¨ä¸€ä¸ªæ•°ç»„(è¿ç»­å†…å­˜ç©ºé—´)å­˜æ”¾é”®å’Œå€¼ï¼Œè€Œæ˜¯ä½¿ç”¨äº†ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«å­˜å‚¨é”®å’Œå€¼ï¼Œå›¾ç¤ºå¦‚ä¸‹ï¼š</p>
<p align="center"><br>  <a href="http://cdn.tigerb.cn/20201217210507.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201217210507.png" style="width:100%"></a><br></p>

<p>ä¸Šå›¾ä¸­ï¼š</p>
<ul>
<li>åˆ†åˆ«å¯¹åº”çš„æ˜¯ä¸¤ä¸ªæ ¸å¿ƒçš„ç»“æ„ä½“<code>hmap</code>å’Œ<code>bmap</code></li>
<li><code>bmap</code>é‡Œæœ‰ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«å­˜æ”¾keyå’Œvalue</li>
</ul>
<p>æŠŠä¸Šé¢ç®€åŒ–çš„å…³ç³»è½¬æ¢ä¸€ä¸‹ï¼Œå…¶å®å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªå¤§è‡´å…³ç³»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p align="center"><br>  <a href="http://cdn.tigerb.cn/20201217210752.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201217210752.png" style="width:100%"></a><br></p>

<p>æˆ‘ä»¬é€šè¿‡ä¸€æ¬¡<code>è¯»æ“ä½œ</code>ä¸ºä¾‹ï¼Œçœ‹çœ‹è¯»å–æŸä¸ªkeyçš„å€¼çš„ä¸€ä¸ª<strong>å¤§è‡´è¿‡ç¨‹</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>æ­¥éª¤ç¼–å·</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>â‘ </td>
<td>é€šè¿‡hashå‡½æ•°è·å–ç›®æ ‡keyçš„<strong>å“ˆå¸Œ</strong>ï¼Œå“ˆå¸Œå’Œæ•°ç»„çš„é•¿åº¦é€šè¿‡ä½æ“ä½œè·å–æ•°ç»„ä½ç½®çš„<strong>ç´¢å¼•</strong>(å¤‡æ³¨ï¼šè·å–ç´¢å¼•å€¼çš„æ–¹å¼ä¸€èˆ¬æœ‰å–æ¨¡æˆ–ä½æ“ä½œï¼Œä½æ“ä½œçš„æ€§èƒ½å¥½äº›)</td>
</tr>
<tr>
<td>â‘¡</td>
<td>éå†bmapé‡Œçš„é”®ï¼Œå’Œç›®æ ‡keyå¯¹æ¯”è·å–<strong>keyçš„ç´¢å¼•</strong>(æ‰¾ä¸åˆ°åˆ™è¿”å›ç©ºå€¼)</td>
</tr>
<tr>
<td>â‘¢</td>
<td>æ ¹æ®<strong>keyçš„ç´¢å¼•</strong>é€šè¿‡è®¡ç®—åç§»é‡ï¼Œè·å–åˆ°å¯¹åº”value</td>
</tr>
</tbody>
</table>
<p>è¯»è¿‡ç¨‹å›¾ç¤ºå¦‚ä¸‹ï¼š</p>
<p align="center"><br>  <a href="http://cdn.tigerb.cn/20201217210816.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201217210816.png" style="width:100%"></a><br></p>

<p>è¿™ä¹ˆçœ‹èµ·æ¥æ˜¯ä¸æ˜¯â€œå¾ˆç®€å•â€ã€å¾ˆæ¸…æ™°ï¼Œæ‰€ä»¥è¯»åˆ°è¿™é‡Œï¼Œä½ æ˜¯ä¸æ˜¯å·²ç»å…¥é—¨äº†<code>Goè¯­è¨€Mapåº•å±‚å®ç°</code>å¹¶ä¸”ï¼š</p>
<ul>
<li><strong>å¤§è‡´</strong>å¯¹Goè¯­è¨€Mapåº•å±‚å®ç°æœ‰ä¸€ä¸ªäº†è§£(æ”¶ç›Š1)</li>
<li><strong>å¤§è‡´çŸ¥é“</strong>Goè¯­è¨€Mapæ˜¯å¦‚ä½•è¯»å–æ•°æ®çš„(æ”¶ç›Š2)</li>
</ul>
<p>ç„¶è€Œå®é™…æƒ…å†µä¸æ­¢å¦‚æ­¤ï¼Œæˆ‘ä»¬å†ç¨å¾®æ·±å…¥çš„æ¢ç´¢ä¸‹ï¼Œæœ‰å…´è¶£çš„å¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹ï¼Œæ²¡å…´è¶£å¯ä»¥ä¸ç”¨ç»§ç»­å¾€ä¸‹çœ‹äº†(å¼€ç©ç¬‘=^_^=)ï¼Œåæ­£å·²ç»è¾¾åˆ°ç›®çš„äº†ï¼Œå“ˆå“ˆğŸ˜ã€‚</p>
<h1 id="Goè¯­è¨€é‡ŒMapçš„å®ç°æ€è·¯-ç†Ÿæ‚‰ç¨‹åº¦"><a href="#Goè¯­è¨€é‡ŒMapçš„å®ç°æ€è·¯-ç†Ÿæ‚‰ç¨‹åº¦" class="headerlink" title="Goè¯­è¨€é‡ŒMapçš„å®ç°æ€è·¯(ç†Ÿæ‚‰ç¨‹åº¦)"></a>Goè¯­è¨€é‡ŒMapçš„å®ç°æ€è·¯(ç†Ÿæ‚‰ç¨‹åº¦)</h1><hr>
<blockquote>
<p>åŒ…å«æ”¶ç›Š3ã€4ã€5ã€6</p>
</blockquote>
<p>æƒ³è¦æ·±å…¥å­¦ä¹ ï¼Œé¦–å…ˆå¾—äº†è§£ä¸‹ä¸Šé¢æåˆ°äº†å®ç°Mapçš„ä¸¤ä¸ªæ ¸å¿ƒç»“æ„ä½“<code>hmap</code>å’Œ<code>bmap</code>ã€‚</p>
<h2 id="æ ¸å¿ƒç»“æ„ä½“hmap"><a href="#æ ¸å¿ƒç»“æ„ä½“hmap" class="headerlink" title="æ ¸å¿ƒç»“æ„ä½“hmap"></a>æ ¸å¿ƒç»“æ„ä½“<code>hmap</code></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ”¶ç›Š3: ç†Ÿæ‚‰Goè¯­è¨€Mapåº•å±‚æ ¸å¿ƒç»“æ„ä½“`hmap`</span><br></pre></td></tr></table></figure>
<p><code>hmap</code>çš„ç»“æ„å…¶å®åˆšå¼€å§‹çœ‹èµ·æ¥å…¶å®è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæœ‰ä¸å°‘çš„å­—æ®µï¼Œå…·ä½“å­—æ®µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p align="center"><br>  <a href="http://cdn.tigerb.cn/20201218132443.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201218132443.png" style="width:20%"></a><br></p>

<p>å­—æ®µé‡Šä¹‰å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>count</td>
<td>é”®å€¼å¯¹çš„æ•°é‡</td>
</tr>
<tr>
<td>B</td>
<td>2^B=len(buckets)</td>
</tr>
<tr>
<td>hash0</td>
<td>hashå› å­</td>
</tr>
<tr>
<td>buckets</td>
<td>æŒ‡å‘ä¸€ä¸ªæ•°ç»„(è¿ç»­å†…å­˜ç©ºé—´)ï¼Œæ•°ç»„çš„ç±»å‹ä¸º[]bmapï¼Œbmapç±»å‹å°±æ˜¯å­˜åœ¨é”®å€¼å¯¹çš„ç»“æ„ä¸‹é¢ä¼šè¯¦ç»†ä»‹ç»ï¼Œè¿™ä¸ªå­—æ®µæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºæ­£å¸¸æ¡¶ã€‚<strong>å¦‚ä¸‹å›¾æ‰€ç¤º</strong></td>
</tr>
<tr>
<td>oldbuckets</td>
<td>æ‰©å®¹æ—¶ï¼Œå­˜æ”¾ä¹‹å‰çš„buckets(Mapæ‰©å®¹ç›¸å…³å­—æ®µ)</td>
</tr>
<tr>
<td>extra</td>
<td>æº¢å‡ºæ¡¶ç»“æ„ï¼Œæ­£å¸¸æ¡¶é‡Œé¢æŸä¸ªbmapå­˜æ»¡äº†ï¼Œä¼šä½¿ç”¨è¿™é‡Œé¢çš„å†…å­˜ç©ºé—´å­˜æ”¾é”®å€¼å¯¹</td>
</tr>
<tr>
<td>noverflow</td>
<td>æº¢å‡ºæ¡¶é‡Œbmapå¤§è‡´çš„æ•°é‡</td>
</tr>
<tr>
<td>nevacuate</td>
<td>åˆ†æµæ¬¡æ•°ï¼Œæˆå€æ‰©å®¹åˆ†æµæ“ä½œè®¡æ•°çš„å­—æ®µ(Mapæ‰©å®¹ç›¸å…³å­—æ®µ)</td>
</tr>
<tr>
<td>flags</td>
<td>çŠ¶æ€æ ‡è¯†ï¼Œæ¯”å¦‚æ­£åœ¨è¢«å†™ã€bucketså’Œoldbucketsåœ¨è¢«éå†ã€ç­‰é‡æ‰©å®¹(Mapæ‰©å®¹ç›¸å…³å­—æ®µ)</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¤‡æ³¨ï¼šæœ¬æ¬¡å†…å®¹ä¸æ¶‰åŠMapçš„æ‰©å®¹é€»è¾‘ã€‚</span><br></pre></td></tr></table></figure>
<p>é‡ç‚¹çœ‹ä¸€äº›å­—æ®µçš„å«ä¹‰å’Œç”¨å¤„ã€‚</p>
<h3 id="å­—æ®µbuckets"><a href="#å­—æ®µbuckets" class="headerlink" title="å­—æ®µbuckets"></a>å­—æ®µ<code>buckets</code></h3><p align="center"><br>  <a href="http://cdn.tigerb.cn/20201216202022.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201216202022.png" style="width:66%"></a><br></p>

<p><code>buckets</code>æŒ‡å‘äº†ä¸€ä¸ªæ•°ç»„(è¿ç»­çš„å†…å­˜ç©ºé—´)ï¼Œæ•°ç»„çš„å…ƒç´ æ˜¯<code>bmap</code>ç±»å‹ï¼Œè¿™ä¸ªå­—æ®µæˆ‘ä»¬ç§°ä¹‹ä¸ºæ­£å¸¸æ¡¶ã€‚</p>
<p><code>hmap</code>çš„æºç å’Œåœ°å€å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://github.com/golang/go/blob/go1.13.8/src/runtime/map.go</span></span><br><span class="line"><span class="keyword">type</span> hmap <span class="keyword">struct</span> &#123;</span><br><span class="line">	count     <span class="keyword">int</span> </span><br><span class="line">	flags     <span class="keyword">uint8</span></span><br><span class="line">	B         <span class="keyword">uint8</span> </span><br><span class="line">	noverflow <span class="keyword">uint16</span> </span><br><span class="line">	hash0     <span class="keyword">uint32</span></span><br><span class="line">	buckets    unsafe.Pointer</span><br><span class="line">	oldbuckets unsafe.Pointer</span><br><span class="line">	nevacuate  <span class="keyword">uintptr</span> </span><br><span class="line">	extra *mapextra</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ ¸å¿ƒç»“æ„ä½“bmap"><a href="#æ ¸å¿ƒç»“æ„ä½“bmap" class="headerlink" title="æ ¸å¿ƒç»“æ„ä½“bmap"></a>æ ¸å¿ƒç»“æ„ä½“<code>bmap</code></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ”¶ç›Š4: Goè¯­è¨€Mapåº•å±‚æ ¸å¿ƒç»“æ„ä½“`bmap`</span><br></pre></td></tr></table></figure>
<p>æ­£å¸¸æ¡¶<code>hmap.buckets</code>çš„å…ƒç´ æ˜¯ä¸€ä¸ª<code>bmap</code>ç»“æ„ã€‚<code>bmap</code>çš„å…·ä½“å­—æ®µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p align="center"><br>  <a href="http://cdn.tigerb.cn/20201216202114.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201216202114.png" style="width:66%"></a><br></p>

<p>å­—æ®µé‡Šä¹‰å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>topbits</td>
<td>é•¿åº¦ä¸º8çš„æ•°ç»„ï¼Œ[]uint8ï¼Œå…ƒç´ ä¸ºï¼škeyè·å–çš„hashçš„é«˜8ä½ï¼Œéå†æ—¶å¯¹æ¯”ä½¿ç”¨ï¼Œæé«˜æ€§èƒ½ã€‚<strong>å¦‚ä¸‹å›¾æ‰€ç¤º</strong></td>
</tr>
<tr>
<td>keys</td>
<td>é•¿åº¦ä¸º8çš„æ•°ç»„ï¼Œ[]keytypeï¼Œå…ƒç´ ä¸ºï¼šå…·ä½“çš„keyå€¼ã€‚<strong>å¦‚ä¸‹å›¾æ‰€ç¤º</strong></td>
</tr>
<tr>
<td>elems</td>
<td>é•¿åº¦ä¸º8çš„æ•°ç»„ï¼Œ[]elemtypeï¼Œå…ƒç´ ä¸ºï¼šé”®å€¼å¯¹çš„keyå¯¹åº”çš„å€¼ã€‚<strong>å¦‚ä¸‹å›¾æ‰€ç¤º</strong></td>
</tr>
<tr>
<td>overflow</td>
<td>æŒ‡å‘çš„<code>hmap.extra.overflow</code>æº¢å‡ºæ¡¶é‡Œçš„<code>bmap</code>ï¼Œä¸Šé¢çš„å­—æ®µ<code>topbits</code>ã€<code>keys</code>ã€<code>elems</code>é•¿åº¦ä¸º8ï¼Œæœ€å¤šå­˜8ç»„é”®å€¼å¯¹ï¼Œå­˜æ»¡äº†å°±å¾€æŒ‡å‘çš„è¿™ä¸ª<code>bmap</code>é‡Œå­˜</td>
</tr>
<tr>
<td>pad</td>
<td>å¯¹é½å†…å­˜ä½¿ç”¨çš„ï¼Œä¸æ˜¯æ¯ä¸ªbmapéƒ½æœ‰ä¼šè¿™ä¸ªå­—æ®µï¼Œéœ€è¦æ»¡è¶³ä¸€å®šæ¡ä»¶</td>
</tr>
</tbody>
</table>
<p align="center"><br>  <a href="http://cdn.tigerb.cn/20201216202224.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201216202224.png" style="width:60%"></a><br></p>

<p>æ¨æ–­å‡º<code>bmap</code>ç»“æ„å­—æ®µçš„ä»£ç å’Œä½ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://github.com/golang/go/blob/go1.13.8/src/cmd/compile/internal/gc/reflect.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bmap</span><span class="params">(t *types.Type)</span> *<span class="title">types</span>.<span class="title">Type</span></span> &#123;</span><br><span class="line">  <span class="comment">// ç•¥...</span></span><br><span class="line"></span><br><span class="line">  field := <span class="built_in">make</span>([]*types.Field, <span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">	field = <span class="built_in">append</span>(field, makefield(<span class="string">"topbits"</span>, arr))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç•¥...</span></span><br><span class="line">  </span><br><span class="line">	keys := makefield(<span class="string">"keys"</span>, arr)</span><br><span class="line">	field = <span class="built_in">append</span>(field, keys)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç•¥...</span></span><br><span class="line">  </span><br><span class="line">	elems := makefield(<span class="string">"elems"</span>, arr)</span><br><span class="line">	field = <span class="built_in">append</span>(field, elems)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç•¥...</span></span><br><span class="line">  </span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">int</span>(elemtype.Align) &gt; Widthptr || <span class="keyword">int</span>(keytype.Align) &gt; Widthptr &#123;</span><br><span class="line">		field = <span class="built_in">append</span>(field, makefield(<span class="string">"pad"</span>, types.Types[TUINTPTR]))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç•¥...</span></span><br><span class="line">  </span><br><span class="line">	overflow := makefield(<span class="string">"overflow"</span>, otyp)</span><br><span class="line">	field = <span class="built_in">append</span>(field, overflow)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç•¥...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç»“è®ºï¼šæ¯ä¸ª<code>bmap</code>ç»“æ„æœ€å¤šå­˜æ”¾8ç»„é”®å€¼å¯¹ã€‚</p>
</blockquote>
<h2 id="hmapå’Œbmapçš„åŸºæœ¬ç»“æ„åˆèµ·æ¥"><a href="#hmapå’Œbmapçš„åŸºæœ¬ç»“æ„åˆèµ·æ¥" class="headerlink" title="hmapå’Œbmapçš„åŸºæœ¬ç»“æ„åˆèµ·æ¥"></a><code>hmap</code>å’Œ<code>bmap</code>çš„åŸºæœ¬ç»“æ„åˆèµ·æ¥</h2><p>åˆ†åˆ«äº†è§£äº†<code>hmap</code>å’Œ<code>bmap</code>çš„åŸºæœ¬ç»“æ„åï¼Œæˆ‘ä»¬æŠŠä¸Šé¢çš„å†…å®¹åˆå¹¶èµ·æ¥ï¼Œå°±å¾—åˆ°å¦‚ä¸‹çš„Mapç»“æ„å›¾ï¼š</p>
<p align="center"><br>  <a href="http://cdn.tigerb.cn/20201216202349.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201216202349.png" style="width:90%"></a><br></p>

<h2 id="æº¢å‡ºæ¡¶"><a href="#æº¢å‡ºæ¡¶" class="headerlink" title="æº¢å‡ºæ¡¶"></a>æº¢å‡ºæ¡¶</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ”¶ç›Š5: ç†Ÿæ‚‰Goè¯­è¨€Mapåº•å±‚é‡Œçš„æº¢å‡ºæ¡¶</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è®²<code>bmap</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸æ˜¯å¾—åˆ°äº†ä¸ªç»“è®ºä¹ˆâ€œæ¯ä¸ª<code>bmap</code>ç»“æ„æœ€å¤šå­˜æ”¾8ç»„é”®å€¼å¯¹ã€‚â€ï¼Œæ‰€ä»¥é—®é¢˜æ¥äº†ï¼š</p>
<blockquote>
<p>æ­£å¸¸æ¡¶é‡Œçš„<code>bmap</code>å­˜æ»¡äº†æ€ä¹ˆåŠ?</p>
</blockquote>
<p>è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å°±è¦è¯´åˆ°<code>hmap.extra</code>ç»“æ„äº†ï¼Œ<code>hmap.extra</code>æ˜¯ä¸ªç»“æ„ä½“ï¼Œç»“æ„å›¾ç¤ºå’Œå­—æ®µé‡Šä¹‰å¦‚ä¸‹ï¼š</p>
<p align="center"><br>  <a href="http://cdn.tigerb.cn/20201216202608.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201216202608.png" style="width:80%"></a><br></p>

<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>overflow</td>
<td>ç§°ä¹‹ä¸º<strong>æº¢å‡ºæ¡¶</strong>ã€‚å’Œ<code>hmap.buckets</code>çš„ç±»å‹ä¸€æ ·ä¹Ÿæ˜¯æ•°ç»„<code>[]bmap</code>ï¼Œå½“æ­£å¸¸æ¡¶<code>bmap</code>å­˜æ»¡äº†çš„æ—¶å€™å°±ä½¿ç”¨<code>hmap.extra.overflow</code>çš„<code>bmap</code>ã€‚æ‰€ä»¥è¿™é‡Œæœ‰ä¸ªé—®é¢˜æ­£å¸¸æ¡¶<code>hmap.buckets</code>é‡Œçš„<code>bmap</code>æ˜¯æ€ä¹ˆå…³è”ä¸Šæº¢å‡ºæ¡¶<code>hmap.extra.overflow</code>çš„<code>bmap</code>å‘¢ï¼Ÿæˆ‘ä»¬ä¸‹é¢è¯´ã€‚</td>
</tr>
<tr>
<td>oldoverflow</td>
<td>æ‰©å®¹æ—¶å­˜æ”¾ä¹‹å‰çš„overflow(Mapæ‰©å®¹ç›¸å…³å­—æ®µ)</td>
</tr>
<tr>
<td>nextoverflow</td>
<td>æŒ‡å‘æº¢å‡ºæ¡¶é‡Œä¸‹ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„<code>bmap</code></td>
</tr>
</tbody>
</table>
<p>æºç å’Œåœ°å€å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://github.com/golang/go/blob/go1.13.8/src/runtime/map.go</span></span><br><span class="line"><span class="keyword">type</span> mapextra <span class="keyword">struct</span> &#123;</span><br><span class="line">	overflow    *[]*bmap</span><br><span class="line">	oldoverflow *[]*bmap</span><br><span class="line">	nextOverflow *bmap</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é—®é¢˜ï¼šæ­£å¸¸æ¡¶<code>hmap.buckets</code>é‡Œçš„<code>bmap</code>æ˜¯<strong>æ€ä¹ˆå…³è”ä¸Š</strong>æº¢å‡ºæ¡¶<code>hmap.extra.overflow</code>çš„<code>bmap</code>å‘¢ï¼Ÿ</p>
</blockquote>
<p>ç­”ï¼šå°±æ˜¯æˆ‘ä»¬ä»‹ç»<code>bmap</code>ç»“æ„æ—¶é‡Œçš„<code>bmap.overflow</code>å­—æ®µ(å¦‚ä¸‹å›¾æ‰€ç¤º)ã€‚<code>bmap.overflow</code>æ˜¯ä¸ªæŒ‡é’ˆç±»å‹ï¼Œå­˜æ”¾äº†å¯¹åº”ä½¿ç”¨çš„æº¢å‡ºæ¡¶<code>hmap.extra.overflow</code>é‡Œçš„<code>bmap</code>çš„åœ°å€ã€‚</p>
<p align="center"><br>  <a href="http://cdn.tigerb.cn/20201221131007.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201221131007.png" style="width:30%"></a><br></p>

<p><strong>é—®é¢˜åˆæ¥äº†</strong>ï¼š</p>
<blockquote>
<p>é—®é¢˜ï¼šæ­£å¸¸æ¡¶<code>hmap.buckets</code>é‡Œçš„<code>bmap</code>æ˜¯<strong>ä»€ä¹ˆæ—¶å€™å…³è”ä¸Š</strong>æº¢å‡ºæ¡¶<code>hmap.extra.overflow</code>çš„<code>bmap</code>å‘¢ï¼Ÿ</p>
</blockquote>
<p>ç­”ï¼šMapå†™æ“ä½œçš„æ—¶å€™ã€‚è¿™é‡Œç›´æ¥çœ‹å…³é”®ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://github.com/golang/go/blob/go1.13.8/src/runtime/map.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapassign</span><span class="params">(t *maptype, h *hmap, key unsafe.Pointer)</span> <span class="title">unsafe</span>.<span class="title">Pointer</span></span> &#123;</span><br><span class="line">  <span class="comment">// ç•¥</span></span><br><span class="line">again:</span><br><span class="line">	<span class="comment">// ç•¥...</span></span><br><span class="line">	<span class="keyword">var</span> inserti *<span class="keyword">uint8</span></span><br><span class="line">  <span class="comment">// ç•¥...</span></span><br><span class="line">bucketloop:</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> i := <span class="keyword">uintptr</span>(<span class="number">0</span>); i &lt; bucketCnt; i++ &#123;</span><br><span class="line">      <span class="comment">// keyçš„hashé«˜8ä½ä¸ç›¸ç­‰</span></span><br><span class="line">			<span class="keyword">if</span> b.tophash[i] != top &#123;</span><br><span class="line">        <span class="comment">// å½“å‰ä½ç½®bmap.tophashçš„å…ƒç´ ä¸ºç©ºä¸”è¿˜æ²¡æœ‰å†™å…¥çš„è®°å½•(insertiå·²ç»å†™å…¥çš„æ ‡è®°ä¸º)</span></span><br><span class="line">				<span class="keyword">if</span> isEmpty(b.tophash[i]) &amp;&amp; inserti == <span class="literal">nil</span> &#123;</span><br><span class="line">          <span class="comment">// insertièµ‹å€¼ä¸ºå½“å‰çš„hashé«˜8ä½ æ ‡è®°å†™å…¥æˆåŠŸ</span></span><br><span class="line">					inserti = &amp;b.tophash[i]</span><br><span class="line">					<span class="comment">// ç•¥...</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">// ç•¥...</span></span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// ç•¥...</span></span><br><span class="line">			<span class="keyword">goto</span> done</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ­£å¸¸æ¡¶çš„bmapéå†å®Œäº† ç»§ç»­éå†æº¢å‡ºæ¡¶çš„bmap å¦‚æœæœ‰çš„è¯</span></span><br><span class="line">		ovf := b.overflow(t)</span><br><span class="line">		<span class="keyword">if</span> ovf == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">		b = ovf</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç•¥...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ²¡å†™å…¥æˆåŠŸ(åŒ…å«æ­£å¸¸æ¡¶çš„bmapã€æº¢å‡ºæ¡¶çš„bmap(å¦‚æœæœ‰çš„è¯))</span></span><br><span class="line">	<span class="keyword">if</span> inserti == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ†é…æ–°çš„bmapå†™</span></span><br><span class="line">    newb := h.newoverflow(t, b)</span><br><span class="line">    <span class="comment">// ç•¥...</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç•¥...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§ç»­çœ‹h.newoverflowçš„ä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *hmap)</span> <span class="title">newoverflow</span><span class="params">(t *maptype, b *bmap)</span> *<span class="title">bmap</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> ovf *bmap</span><br><span class="line">  <span class="comment">// å¦‚æœhmapçš„å­˜åœ¨æº¢å‡ºæ¡¶ ä¸” æº¢å‡ºæ¡¶è¿˜æ²¡ç”¨å®Œ</span></span><br><span class="line">	<span class="keyword">if</span> h.extra != <span class="literal">nil</span> &amp;&amp; h.extra.nextOverflow != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æº¢å‡ºæ¡¶çš„bmap</span></span><br><span class="line">    ovf = h.extra.nextOverflow</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ¡¶çš„bmapçš„overflowæ˜¯ä¸æ˜¯ç©º</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œå¾ˆå·§å¦™ã€‚ä¸ºå•¥ï¼Ÿ</span></span><br><span class="line">    <span class="comment">// æº¢å‡ºæ¡¶åˆå§‹åŒ–çš„æ—¶å€™ä¼šæŠŠæœ€åä¸€ä¸ªbmapçš„overflowæŒ‡å‘æ­£å¸¸æ¡¶ï¼Œå€¼ä¸ä¸ºnil</span></span><br><span class="line">    <span class="comment">// ç›®çš„åˆ¤æ–­å½“å‰è¿™ä¸ªbmapæ˜¯ä¸æ˜¯æº¢å‡ºæ¡¶é‡Œçš„æœ€åä¸€ä¸ª</span></span><br><span class="line">		<span class="keyword">if</span> ovf.overflow(t) == <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="comment">// æ˜¯nil</span></span><br><span class="line">      <span class="comment">// è¯´æ˜ä¸æ˜¯æœ€åä¸€ä¸ª</span></span><br><span class="line">			h.extra.nextOverflow = (*bmap)(add(unsafe.Pointer(ovf), <span class="keyword">uintptr</span>(t.bucketsize)))</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ä¸æ˜¯nil</span></span><br><span class="line">      <span class="comment">// åˆ™é‡ç½®å½“å‰bmapçš„overflowä¸ºç©º</span></span><br><span class="line">      ovf.setoverflow(t, <span class="literal">nil</span>)</span><br><span class="line">      <span class="comment">// ä¸” æ ‡è®°nextOverflowä¸ºnil è¯´æ˜å½“å‰æº¢å‡ºæ¡¶ç”¨å®Œäº†</span></span><br><span class="line">			h.extra.nextOverflow = <span class="literal">nil</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰æº¢å‡ºæ¡¶ æˆ–è€… æº¢å‡ºæ¡¶ç”¨å®Œäº†</span></span><br><span class="line">    <span class="comment">// å†…å­˜ç©ºé—´é‡æ–°åˆ†é…ä¸€ä¸ªbmap</span></span><br><span class="line">		ovf = (*bmap)(newobject(t.bucket))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç”Ÿæˆæº¢å‡ºæ¡¶bmapçš„è®¡æ•°å™¨è®¡æ•°</span></span><br><span class="line">	h.incrnoverflow()</span><br><span class="line">  <span class="comment">// ç•¥...</span></span><br><span class="line">  <span class="comment">// è¿™è¡Œä»£ç å°±æ˜¯ä¸Šé¢é—®é¢˜æˆ‘ä»¬è¦çš„ç­”æ¡ˆ:</span></span><br><span class="line">  <span class="comment">// æ­£å¸¸æ¡¶`hmap.buckets`é‡Œçš„`bmap`åœ¨è¿™é‡Œå…³è”ä¸Šæº¢å‡ºæ¡¶`hmap.extra.overflow`çš„`bmap`</span></span><br><span class="line">	b.setoverflow(t, ovf)</span><br><span class="line">	<span class="keyword">return</span> ovf</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setoverflowå‡½æ•°çš„æºç </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *bmap)</span> <span class="title">setoverflow</span><span class="params">(t *maptype, ovf *bmap)</span></span> &#123;</span><br><span class="line">  <span class="comment">// è¿™è¡Œä»£ç çš„æ„æ€ï¼šé€šè¿‡åç§»é‡è®¡ç®—æ‰¾åˆ°äº†bmap.overflowï¼Œå¹¶æŠŠovfè¿™ä¸ªbmapçš„åœ°å€èµ‹å€¼ç»™äº†bmap.overflow</span></span><br><span class="line">	*(**bmap)(add(unsafe.Pointer(b), <span class="keyword">uintptr</span>(t.bucketsize)-sys.PtrSize)) = ovf</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢ä»£ç è¿™æ®µä»£ç è§£é‡Šäº†ï¼Œä¸Šé¢çš„æºç ä¸­ä¸ºä½•å¦‚æ­¤åˆ¤æ–­é¢„åˆ†é…æº¢å‡ºæ¡¶çš„<code>bmap</code>æ˜¯æœ€åä¸€ä¸ªçš„åŸå› ã€‚<br><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://github.com/golang/go/blob/go1.13.8/src/runtime/map.go</span></span><br><span class="line"><span class="comment">// åˆ›å»ºhmapçš„æ­£å¸¸æ¡¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeBucketArray</span><span class="params">(t *maptype, b <span class="keyword">uint8</span>, dirtyalloc unsafe.Pointer)</span> <span class="params">(buckets unsafe.Pointer, nextOverflow *bmap)</span></span> &#123;</span><br><span class="line">  <span class="comment">// ç•¥...</span></span><br><span class="line">	<span class="keyword">if</span> base != nbuckets &#123;</span><br><span class="line">    <span class="comment">// ç•¥...</span></span><br><span class="line">    last := (*bmap)(add(buckets, (nbuckets<span class="number">-1</span>)*<span class="keyword">uintptr</span>(t.bucketsize)))</span><br><span class="line">    <span class="comment">// æŠŠæº¢å‡ºæ¡¶é‡Œ æœ€åä¸€ä¸ª `bmap`çš„`overflow`æŒ‡å…ˆæ­£å¸¸æ¡¶çš„ç¬¬ä¸€ä¸ª`bmap`</span></span><br><span class="line">    <span class="comment">// è·å–é¢„åˆ†é…çš„æº¢å‡ºæ¡¶é‡Œ`bmap`æ—¶ï¼Œå¯ä»¥é€šè¿‡åˆ¤æ–­overflowæ˜¯ä¸æ˜¯ä¸ºnilåˆ¤æ–­æ˜¯ä¸æ˜¯æœ€åä¸€ä¸ª</span></span><br><span class="line">		last.setoverflow(t, (*bmap)(buckets))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç•¥...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>å½“<code>hmap</code>å­˜åœ¨æº¢å‡ºæ¡¶æ—¶ï¼Œä¸”å½“å‰æº¢å‡ºæ¡¶åªè¢«ä½¿ç”¨äº†ä¸€ä¸ªbamp</strong>æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„å…³ç³»å›¾ï¼š</p>
<p align="center"><br>  <a href="http://cdn.tigerb.cn/20201217165310.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201217165310.png" style="width:90%"></a><br></p>

<p>åŒæ—¶æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ­£å¸¸æ¡¶çš„<code>bmap</code>å’Œæº¢å‡ºæ¡¶çš„<code>bmap</code>å®é™…æ„æˆäº†é“¾è¡¨å…³ç³»ï¼Œæ‰€ä»¥è¿™ä¹Ÿè§£é‡Šäº†å¼€ç¯‡æˆ‘ä»¬è¯´åˆ°çš„â€œGoé‡Œé¢Mapçš„å®ç°<strong>ä¸»è¦</strong>ç”¨åˆ°äº†æ•°ç»„â€ï¼Œå…¶æ¬¡è¿˜ç”¨åˆ°äº†é“¾è¡¨ã€‚</p>
<h2 id="å†æ¬¡åˆ†æMapçš„è¯»"><a href="#å†æ¬¡åˆ†æMapçš„è¯»" class="headerlink" title="å†æ¬¡åˆ†æMapçš„è¯»"></a>å†æ¬¡åˆ†æMapçš„è¯»</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ”¶ç›Š6: ç†Ÿæ‚‰Goè¯­è¨€Mapæ˜¯å¦‚ä½•è¯»å–æ•°æ®çš„</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šé¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å†æ¬¡é€šè¿‡ä¸€æ¬¡è¯»æ“ä½œä¸ºä¾‹ï¼Œçœ‹çœ‹è¯»å–æŸä¸ªkeyçš„å€¼çš„ä¸€ä¸ªå¤§è‡´è¿‡ç¨‹ï¼š</p>
<p align="center"><br>  <a href="http://cdn.tigerb.cn/20201217165551.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20201217165551.png" style="width:90%"></a><br></p>

<p>ç»“åˆä»£ç åˆ†æä¸‹æ•´ä¸ªå¤§ä½“çš„è¿‡ç¨‹ï¼š<br><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mapaccess1</span><span class="params">(t *maptype, h *hmap, key unsafe.Pointer)</span> <span class="title">unsafe</span>.<span class="title">Pointer</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...ç•¥</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// â‘ é€šè¿‡hashå‡½æ•°è·å–å½“å‰keyçš„å“ˆå¸Œ</span></span><br><span class="line">	hash := alg.hash(key, <span class="keyword">uintptr</span>(h.hash0))</span><br><span class="line">    m := bucketMask(h.B)</span><br><span class="line">    <span class="comment">// â‘¡é€šè¿‡å½“å‰keyçš„å“ˆå¸Œè·å–åˆ°å¯¹åº”çš„bmapç»“æ„çš„b</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„b æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œæ­£å¸¸æ¡¶çš„bmapâ€</span></span><br><span class="line">    <span class="comment">// â€œæ­£å¸¸æ¡¶çš„bmapâ€å¯èƒ½ä¼šå¯¹åº”åˆ°æº¢å‡ºæ¡¶çš„bmapç»“æ„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œæº¢å‡ºæ¡¶çš„bmapâ€</span></span><br><span class="line">    b := (*bmap)(add(h.buckets, (hash&amp;m)*<span class="keyword">uintptr</span>(t.bucketsize)))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...ç•¥</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–å½“å‰keyçš„å“ˆå¸Œçš„é«˜8ä½</span></span><br><span class="line">	top := tophash(hash)</span><br><span class="line">bucketloop:</span><br><span class="line">    <span class="comment">// ä¸‹é¢çš„forå¾ªç¯æ˜¯ä¸ªç®€å†™ï¼Œå®Œæ•´å¦‚ä¸‹ã€‚</span></span><br><span class="line">    <span class="comment">// for b = b; b != nil; b = b.overflow(t) &#123;</span></span><br><span class="line">    <span class="comment">// å¯ä»¥çŸ¥é“bçš„åˆå§‹å€¼ä¸ºä¸Šé¢çš„â€œæ­£å¸¸æ¡¶çš„bmapâ€ï¼Œåˆ™ï¼š</span></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡éå†ï¼šéå†çš„æ˜¯â€œæ­£å¸¸æ¡¶çš„bmapâ€</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ­£å¸¸æ¡¶æ²¡æ‰¾åˆ°ï¼Œåˆ™</span></span><br><span class="line">    <span class="comment">// ç»¿è‰²çº¿æ¡â‘£ ç»§ç»­éå†ï¼šå¦‚æœå½“å‰â€œæ­£å¸¸æ¡¶çš„bmapâ€ä¸­çš„overflowå€¼ä¸ä¸ºnil(è¯´æ˜â€œæ­£å¸¸æ¡¶çš„bmapâ€å…³è”äº†â€œæº¢å‡ºæ¡¶çš„bmapâ€)ï¼Œåˆ™éå†å½“å‰æŒ‡å‘çš„â€œæº¢å‡ºæ¡¶çš„bmapâ€ç»§ç»­ è“è‰²çº¿æ¡çš„â‘¢â‘£â‘¤æ­¥éª¤</span></span><br><span class="line">	<span class="keyword">for</span> ; b != <span class="literal">nil</span>; b = b.overflow(t) &#123;</span><br><span class="line">        <span class="comment">// ç”±äºbçš„åˆå§‹å€¼ä¸ºâ€œæ­£å¸¸æ¡¶çš„bmapâ€ï¼Œç¬¬ä¸€æ¬¡å…ˆéå†â€œæ­£å¸¸æ¡¶çš„bmapâ€</span></span><br><span class="line">		<span class="keyword">for</span> i := <span class="keyword">uintptr</span>(<span class="number">0</span>); i &lt; bucketCnt; i++ &#123;</span><br><span class="line">            <span class="comment">// è“è‰²çº¿æ¡â‘¢ å¯¹æ¯”keyå“ˆå¸Œçš„é«˜8ä½</span></span><br><span class="line">            <span class="comment">// å¯¹æ¯”å“ˆå¸Œçš„é«˜8ä½ç›®çš„æ˜¯ä¸ºäº†åŠ é€Ÿ</span></span><br><span class="line">			<span class="keyword">if</span> b.tophash[i] != top &#123;</span><br><span class="line">                <span class="comment">// emptyRest æ ‡å¿—ä½ï¼šè¡¨ç¤ºå½“å‰ä½ç½®å·²ç»æ˜¯æœ«å°¾äº†ï¼›åˆ é™¤æ“ä½œä¼šè®¾ç½®æ­¤æ ‡å¿—ä½</span></span><br><span class="line">				<span class="keyword">if</span> b.tophash[i] == emptyRest &#123;</span><br><span class="line">					<span class="keyword">break</span> bucketloop</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ‰¾åˆ°äº†ç›¸åŒçš„hashé«˜8ä½ï¼Œåˆ™ï¼šæ‰¾åˆ°å¯¹åº”ç´¢å¼•ä½ç½®içš„key</span></span><br><span class="line">			k := add(unsafe.Pointer(b), dataOffset+i*<span class="keyword">uintptr</span>(t.keysize))</span><br><span class="line">			<span class="keyword">if</span> t.indirectkey() &#123;</span><br><span class="line">				k = *((*unsafe.Pointer)(k))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è“è‰²çº¿æ¡â‘£ å¯¹æ¯”keyæ˜¯ä¸æ˜¯ä¸€è‡´</span></span><br><span class="line">			<span class="keyword">if</span> alg.equal(key, k) &#123;</span><br><span class="line">                <span class="comment">// è“è‰²çº¿æ¡â‘¤ keyæ˜¯ä¸€è‡´ï¼Œåˆ™ï¼šè·å–å¯¹åº”ç´¢å¼•ä½ç½®çš„å€¼</span></span><br><span class="line">				e := add(unsafe.Pointer(b), dataOffset+bucketCnt*<span class="keyword">uintptr</span>(t.keysize)+i*<span class="keyword">uintptr</span>(t.elemsize))</span><br><span class="line">				<span class="keyword">if</span> t.indirectelem() &#123;</span><br><span class="line">					e = *((*unsafe.Pointer)(e))</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// è¿”å›æ‰¾åˆ°çš„ç»“æœ</span></span><br><span class="line">				<span class="keyword">return</span> e</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ­£å¸¸æ¡¶ã€æº¢å‡ºæ¡¶éƒ½æ²¡æ‰¾åˆ°åˆ™è¿”å› â€œç©ºå€¼â€</span></span><br><span class="line">	<span class="keyword">return</span> unsafe.Pointer(&amp;zeroVal[<span class="number">0</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>åŸåˆ›ä¸æ˜“ï¼Œå¹´åº•äº†ï¼Œå¾ä¸€æ³¢ç¨¿è´¹ï¼Œ1å…ƒå°±è¡Œï¼Œåœ¨æ­¤è°¢è¿‡å¤§å®¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å‚è€ƒï¼š</span><br><span class="line">1.ã€ŠGoè¯­è¨€è®¾è®¡ä¸å®ç°ã€‹https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-hashmap/</span><br><span class="line">2. Goæºç ç‰ˆæœ¬1.13.8 https://github.com/golang/go/tree/go1.13.8/src</span><br></pre></td></tr></table></figure></span></div><script src="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/js/lightgallery.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script>

<!-- Tags -->



<div class="tags">
    <a href="/tags/Go/" class="button small">Go</a>
</div>



<!-- Qrcode -->
<div width="100px">
    <img src="http://cdn.tigerb.cn/wechat-blog-qrcode.jpg" alt="TIGERB" width="300px" style="display:block; margin: 30px auto 0px auto;">
</div>

<!-- Comments -->
<div>
    


</div>



            </div>
        </div>

        <!-- Footer -->
<footer id="footer">
    <div class="inner">
        <section>
            <h2>About</h2>
            <div>
                æ–°ä¸€ä»£è½»é‡çº§PHPæ¡†æ¶ã€Œ<a href='http://easy-php.tigerb.cn'>EasyPHP</a>ã€ä½œè€…ï¼Œã€Œ<a href='http://skrshop.tech/'>ã€Šç”µå•†è®¾è®¡æ‰‹å†Œ | SkrShopã€‹</a>ã€ä½œè€…ï¼Œã€Œ<a href='http://tigerb.cn/go-patterns'>ã€ŠGoè®¾è®¡æ¨¡å¼å®æˆ˜ã€‹ç³»åˆ—</a>ã€ä½œè€…ã€‚æ‹¥æœ‰åˆ›ä¸š&ä¸Šå¸‚å…¬å¸ç”µå•†å¼€å‘ç»éªŒï¼Œç°äºå°ç±³é›†å›¢ä»äº‹åç«¯å¼€å‘å·¥ä½œã€‚
            </div>
        </section>
        <section>
            <h2>Follow</h2>
            <ul class="icons">
                
                    <li><a href="https://twitter.com/CODERCOOKER" class="icon style2 fa-twitter" target="_blank" ><span class="label">Twitter</span></a></li>
                
                
                
                    <li><a href="https://www.instagram.com/codercooker/" class="icon style2 fa-instagram" target="_blank" ><span class="label">Instagram</span></a></li>
                
                
                
                    <li><a href="https://github.com/TIGERB" class="icon style2 fa-github" target="_blank" ><span class="label">GitHub</span></a></li>
                
                
                
                
                
                    <li><a href="mailto:tigerbcode@gmail.com" class="icon style2 fa-envelope-o" target="_blank" ><span class="label">Email</span></a></li>
                
                
                    <li><a href="\atom.xml" class="icon style2 fa-rss" target="_blank" ><span class="label">RSS</span></a></li>
                
            </ul>
        </section>
        <ul class="copyright">
            <li>&copy; TIGERB.cn All right reserved. æ´¥ICPå¤‡17006784å·-2</li>
            <li><a href="https://juejin.im/user/5855e82d1b69e6006c9278b4" target="_blank">juejin</a></li>
            <li><a href="https://segmentfault.com/u/tigerb" target="_blank">Segmentfault</a></li>
            <li><a href="http://skrshop.tech/">ç”µå•†è®¾è®¡æ‰‹å†Œ | SkrShop</a></li>
            <li><a href="https://dayutalk.cn/">å¤§æ„šTalk</a></li>
        </ul>
    </div>
</footer>
    </div>

    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- skel -->
<script src="/js/skel.min.js"></script>

<!-- Custom Code -->
<script src="/js/util.js"></script>

<!--[if lte IE 8]>
<script src="/js/ie/respond.min.js"></script>
<![endif]-->

<!-- Custom Code -->
<script src="/js/main.js"></script>

<!-- Gallery -->
<script src="https://cdn.bootcss.com/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->


</body>

</html>