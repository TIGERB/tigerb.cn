<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="Trying to be the person you want to be.">
    

    <!--Author-->
    
        <meta name="author" content="TIGERB">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="什么，秒杀系统也有这么多种！"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="TIGERB"/>

    <!--Page Cover-->
    
        <meta property="og:image" content="undefined"/>
    

    <!-- Title -->
    
    <title>什么，秒杀系统也有这么多种！ - TIGERB</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/sass/main.css">

    <!--[if lt IE 8]>
        <script src="/js/ie/html5shiv.js"></script>
    <![endif]-->

    <!--[if lt IE 8]>
        <link rel="stylesheet" href="/sass/ie8.css">
    <![endif]-->

    <!--[if lt IE 9]>
        <link rel="stylesheet" href="/sass/ie9.css">
    <![endif]-->

    <!-- Gallery -->
    <link href="https://cdn.bootcss.com/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?30c7e7d53256334a8dc1cf524fcc77f6";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
    })();
    </script>

</head>

<body>

    <div id="wrapper">

        <!-- Menu -->
        <!-- Header -->
<header id="header">
    <div class="inner">

        <!-- Logo -->
        <a href="/" class="logo">
            <span class="symbol"><img src="http://cdn.tigerb.cn/20190707142019.png" alt="" /></span><span class="title">TIGERB</span>
        </a>

        <!-- Nav -->
        <nav>
            <ul>
                <li><a href="#menu">Menu</a></li>
            </ul>
        </nav>

    </div>
</header>

<!-- Menu -->
<nav id="menu">
    <h2>Menu</h2>
    <ul>
        
            <li>
                <a href="/">首页</a>
            </li>
        
            <li>
                <a href="https://github.com/TIGERB">Github</a>
            </li>
        
            <li>
                <a href="https://segmentfault.com/u/tigerb">Segmentfault</a>
            </li>
        
            <li>
                <a href="https://juejin.im/user/5855e82d1b69e6006c9278b4">掘金</a>
            </li>
        
    </ul>
</nav>


        <div id="main">
            <div class="inner">

                <!-- Main Content -->
                

    <h1 class="title">什么，秒杀系统也有这么多种！</h1>
    <div class="meta">
        2020-05-05
    </div>


    <span class="image main"><img src="http://cdn.tigerb.cn/20200505124913.jpg?imageMogr2/thumbnail/1500x1000!/format/webp/blur/1x0/quality/75|imageslim" alt="" /></span>


<!-- Gallery -->


<!-- Content -->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/css/lightgallery.min.css"><div class=".article-gallery" <hr="">
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文结构很简单：</p>
<blockquote>
<p>5张图送你5种秒杀系统，再加点骚操作，再顺带些点心里话🤷‍♀️。</p>
</blockquote>
<h1 id="一个简单的秒杀系统"><a href="#一个简单的秒杀系统" class="headerlink" title="一个简单的秒杀系统"></a>一个简单的秒杀系统</h1><p><strong>实现原理：</strong> 通过redis原子操作减库存</p>
<p><strong>图一</strong></p>
<p align="center"><br>    <a href="http://cdn.tigerb.cn/20200501175532.png" target="_blank" rel="noopener"><br>        <a href="http://cdn.tigerb.cn/20200501175532.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20200501175532.png" width="90%"></a><br>    </a><br></p>

<table>
<thead>
<tr>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>简单好用</td>
<td>考验redis服务能力</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>是否公平</th>
</tr>
</thead>
<tbody>
<tr>
<td>公平</td>
</tr>
<tr>
<td>先到先得</td>
</tr>
</tbody>
</table>
<p>我们称这类秒杀系统为：</p>
<blockquote>
<p>简单秒杀系统</p>
</blockquote>
<p>如果刚开始QPS并不高，redis完全抗的下来的情况，完全可以依赖这个「简单秒杀系统」。</p>
<h1 id="一个够用的秒杀系统"><a href="#一个够用的秒杀系统" class="headerlink" title="一个够用的秒杀系统"></a>一个够用的秒杀系统</h1><p><strong>实现原理：</strong> 服务内存限流算法 + redis原子操作减库存</p>
<p><strong>图二</strong></p>
<p align="center"><br>    <a href="http://cdn.tigerb.cn/20200501183037.png" target="_blank" rel="noopener"><br>        <a href="http://cdn.tigerb.cn/20200501183037.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20200501183037.png" width="90%"></a><br>    </a><br></p>

<table>
<thead>
<tr>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>简单好用</td>
<td>-</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>是否公平</th>
</tr>
</thead>
<tbody>
<tr>
<td>不是很公平</td>
</tr>
<tr>
<td>相对的先到先得</td>
</tr>
</tbody>
</table>
<p>我们称这类秒杀系统为：</p>
<blockquote>
<p>够用秒杀系统</p>
</blockquote>
<h1 id="性能再好点的秒杀系统"><a href="#性能再好点的秒杀系统" class="headerlink" title="性能再好点的秒杀系统"></a>性能再好点的秒杀系统</h1><p><strong>实现原理：</strong> 服务本地内存原子操作减库存</p>
<blockquote>
<p>服务本地内存的库存怎么来的？</p>
</blockquote>
<p>活动开始前分配好每台机器的库存，推送到机器上。</p>
<p><strong>图三</strong></p>
<p align="center"><br>    <a href="http://cdn.tigerb.cn/20200501200309.png" target="_blank" rel="noopener"><br>        <a href="http://cdn.tigerb.cn/20200501200309.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20200501200309.png" width="90%"></a><br>    </a><br></p>

<table>
<thead>
<tr>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>高性能</td>
<td>不支持动态伸缩容(活动进行期间)，因为库存是活动开始前分配好的</td>
</tr>
<tr>
<td>释放redis压力</td>
<td>-</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>是否公平</th>
</tr>
</thead>
<tbody>
<tr>
<td>不是很公平</td>
</tr>
<tr>
<td>不是绝对的先到先得</td>
</tr>
</tbody>
</table>
<p>我们称这类秒杀系统为：</p>
<blockquote>
<p>预备库存秒杀系统</p>
</blockquote>
<h1 id="支持动态伸缩容的秒杀系统"><a href="#支持动态伸缩容的秒杀系统" class="headerlink" title="支持动态伸缩容的秒杀系统"></a>支持动态伸缩容的秒杀系统</h1><p><strong>实现原理：</strong> 服务本地协程Coroutine<strong>定时redis原子操作减部分库存</strong>到本地内存 + 服务本地内存原子操作减库存</p>
<p><strong>图四</strong></p>
<p align="center"><br>    <a href="http://cdn.tigerb.cn/20200501200846.png" target="_blank" rel="noopener"><br>        <a href="http://cdn.tigerb.cn/20200501200846.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20200501200846.png" width="90%"></a><br>    </a><br></p>

<table>
<thead>
<tr>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>高性能</td>
<td>-</td>
</tr>
<tr>
<td>支持动态伸缩容(活动进行期间)</td>
<td>-</td>
</tr>
<tr>
<td>释放redis压力</td>
<td>-</td>
</tr>
<tr>
<td><strong>具备通用性</strong></td>
<td>-</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>是否公平</th>
</tr>
</thead>
<tbody>
<tr>
<td>不是很公平，但是好了点</td>
</tr>
<tr>
<td>几乎先到先得</td>
</tr>
</tbody>
</table>
<p>我们称这类秒杀系统为：</p>
<blockquote>
<p>实时预备库存秒杀系统</p>
</blockquote>
<h1 id="公平的秒杀系统"><a href="#公平的秒杀系统" class="headerlink" title="公平的秒杀系统"></a>公平的秒杀系统</h1><p><strong>实现原理：</strong> 服务本地Goroutine<strong>定时同步是否售罄</strong>到本地内存 + 队列 + 排队成功轮训(或主动Push)结果</p>
<p><strong>图五</strong></p>
<p align="center"><br>    <a href="http://cdn.tigerb.cn/20200502195413.png" target="_blank" rel="noopener"><br>        <a href="http://cdn.tigerb.cn/20200502195413.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20200502195413.png" width="90%"></a><br>    </a><br></p>

<table>
<thead>
<tr>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>高性能</td>
<td>开发成本高(需主动通知或轮训排队结果)</td>
</tr>
<tr>
<td>真公平</td>
<td>-</td>
</tr>
<tr>
<td><strong>具备通用性</strong></td>
<td>-</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>是否公平</th>
</tr>
</thead>
<tbody>
<tr>
<td>很公平</td>
</tr>
<tr>
<td>绝对的先到先得</td>
</tr>
</tbody>
</table>
<p>我们称这类秒杀系统为：</p>
<blockquote>
<p>公平排队秒杀系统</p>
</blockquote>
<h1 id="骚操作"><a href="#骚操作" class="headerlink" title="骚操作"></a>骚操作</h1><blockquote>
<p>上面的秒杀系统还不够完美吗？</p>
</blockquote>
<p>答案：是的。</p>
<blockquote>
<p>还有什么优化的空间？</p>
</blockquote>
<p>答案：静态化获取秒杀活动信息的接口。</p>
<blockquote>
<p>静态化是什么意思?</p>
</blockquote>
<p>答案：比如获取秒杀活动信息是通过接口 <code>https://seckill.skrshop.tech/v1/acticity/get</code> 获取的。现在呢，我们需要通过<code>https://static-api.skrshop.tech/seckill/v1/acticity/get</code> 这个接口获取。有什么区别呢？看下面：</p>
<table>
<thead>
<tr>
<th>服务名</th>
<th>接口</th>
<th>数据存储位置</th>
</tr>
</thead>
<tbody>
<tr>
<td>秒杀服务</td>
<td><a href="https://seckill.skrshop.tech/v1/acticity/get" target="_blank" rel="noopener">https://seckill.skrshop.tech/v1/acticity/get</a></td>
<td>秒杀服务内存或redis等</td>
</tr>
<tr>
<td>接口静态化服务</td>
<td><a href="https://static-api.skrshop.tech/seckill/v1/acticity/get" target="_blank" rel="noopener">https://static-api.skrshop.tech/seckill/v1/acticity/get</a></td>
<td>CDN、本地文件</td>
</tr>
</tbody>
</table>
<p><strong>以前是这样</strong></p>
<p align="center"><br>    <a href="http://cdn.tigerb.cn/20200502195950.png" target="_blank" rel="noopener"><br>        <a href="http://cdn.tigerb.cn/20200502195950.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20200502195950.png" width="66%"></a><br>    </a><br></p>

<p><strong>变成了这样</strong></p>
<p align="center"><br>    <a href="http://cdn.tigerb.cn/20200502200723.png" target="_blank" rel="noopener"><br>        <a href="http://cdn.tigerb.cn/20200502200723.png" class="gallery-item" target="_blank" rel="noopener"><img src="http://cdn.tigerb.cn/20200502200723.png" width="90%"></a><br>    </a><br></p>

<p>结果：可以通过接口<code>https://static-api.skrshop.tech/seckill/v1/acticity/get</code>就获取到了秒杀活动信息，流量都分摊到了cdn，秒杀服务自身没了这部分的负载。</p>
<blockquote>
<p>小声点说：“秒杀结果我也敢推CDN😏😏😏。”</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">备注：</span><br><span class="line">之后我们会分享`如何用Golang设计一个好用的「接口静态化服务」`。</span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>上面我们得到了如下几类<code>秒杀系统</code></p>
<table>
<thead>
<tr>
<th></th>
<th>秒杀系统</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>简单秒杀系统</td>
<td></td>
</tr>
<tr>
<td></td>
<td>够用秒杀系统</td>
<td></td>
</tr>
<tr>
<td></td>
<td>预备库存秒杀系统</td>
<td></td>
</tr>
<tr>
<td></td>
<td>实时预备库存秒杀系统</td>
<td></td>
</tr>
<tr>
<td></td>
<td>公平排队秒杀系统</td>
<td></td>
</tr>
</tbody>
</table>
<p>我想说的是里面没有最好的方案，也没有最坏的方案，只有<strong>适合你</strong>的。</p>
<p>拿<code>先到先得</code>来说，一定要看你们的产品对外宣传，切勿上来就追逐绝对的先到先得。其实你看所有的方案，相对而言都是“先到先得”，比如，活动开始一个小时了你再来抢，那相对于准时的用户自然抢不过，对吧。</p>
<p>又如<code>预备库存秒杀系统</code>，虽然不支持动态伸缩容。但是如果你的环境满足如下任意条件，就完全够用了。</p>
<ul>
<li>秒杀场景结束时间之快，通常几秒就结束了，真实活动可能会发生如下情况：<ul>
<li>服务压力大还没挂：根本就来不及动态伸缩容</li>
<li>服务压力大已经挂了：可以先暂停活动，服务起来&amp;扩容结束，用剩余库存重新推送</li>
</ul>
</li>
<li>运维自身不具备动态伸缩容的能力</li>
</ul>
<p>所以:</p>
<blockquote>
<p>合适好用就行，切勿过度设计。</p>
</blockquote>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>这次算是把老本都吐露出来了，真是慌得一匹。</p>
</div><script src="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/js/lightgallery.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script>

<!-- Tags -->



<div class="tags">
    <a href="/tags/shop/" class="button small">shop</a> <a href="/tags/秒杀系统/" class="button small">秒杀系统</a>
</div>



<!-- Qrcode -->
<div width="100px">
    <img src="http://cdn.tigerb.cn/wechat-blog-qrcode.jpg" alt="TIGERB" width="300px" style="display:block; margin: 30px auto 0px auto;">
</div>

<!-- Comments -->
<div>
    


</div>



            </div>
        </div>

        <!-- Footer -->
<footer id="footer">
    <div class="inner">
        <section>
            <h2>About</h2>
            <div>
                新一代轻量级「<a href='http://easy-php.tigerb.cn'>EasyPHP</a>」框架作者，<a href="/php2go/#/">「《PHP到Go速转手册》」作者</a>，「<a href='http://skrshop.tech/'>《电商设计手册 | SkrShop》</a>」作者，「<a href='http://tigerb.cn/go/#/patterns/'>《Go设计模式实战》系列</a>」作者，「<a href='http://tigerb.cn/go/#/kernal/'>《Go语言轻松进阶》系列</a>」作者。拥有丰富的电商系统开发经验，现于小米集团从事后端研发工作。<br><br><img style="vertical-align:middle" width="30%" src="http://cdn.tigerb.cn/wechat-blog-qrcode.jpg?imageMogr2/thumbnail/260x260!/format/webp/blur/1x0/quality/90|imageslim">
            </div>
        </section>
        <section>
            <h2>Follow</h2>
            <ul class="icons">
                
                    <li><a href="https://twitter.com/CODERCOOKER" class="icon style2 fa-twitter" target="_blank" ><span class="label">Twitter</span></a></li>
                
                
                
                
                
                    <li><a href="https://github.com/TIGERB" class="icon style2 fa-github" target="_blank" ><span class="label">GitHub</span></a></li>
                
                
                
                
                
                    <li><a href="mailto:tigerbcode@gmail.com" class="icon style2 fa-envelope-o" target="_blank" ><span class="label">Email</span></a></li>
                
                
                    <li><a href="\atom.xml" class="icon style2 fa-rss" target="_blank" ><span class="label">RSS</span></a></li>
                
            </ul>
        </section>
        <ul class="copyright">
            <li>&copy; TIGERB.cn All right reserved. 津ICP备17006784号-2</li>
            <li><a href="https://juejin.im/user/5855e82d1b69e6006c9278b4" target="_blank">juejin</a></li>
            <li><a href="https://segmentfault.com/u/tigerb" target="_blank">Segmentfault</a></li>
            <li><a href="http://skrshop.tech/">电商设计手册 | SkrShop</a></li>
            <li><a href="http://tigerb.cn/go/#/patterns/">Go设计模式实战</a></li>
            <li><a href="http://tigerb.cn/go/#/kernal/">Go语言轻松进阶</a></li>
            <li><a href="https://dayutalk.cn/">大愚Talk</a></li>
        </ul>
    </div>
</footer>
    </div>

    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- skel -->
<script src="/js/skel.min.js"></script>

<!-- Custom Code -->
<script src="/js/util.js"></script>

<!--[if lte IE 8]>
<script src="/js/ie/respond.min.js"></script>
<![endif]-->

<!-- Custom Code -->
<script src="/js/main.js"></script>

<!-- Gallery -->
<script src="https://cdn.bootcss.com/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->


</body>

</html>