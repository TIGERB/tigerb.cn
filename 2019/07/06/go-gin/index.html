<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="Trying to be the person you want to be.">
    

    <!--Author-->
    
        <meta name="author" content="æ–½å±•">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Goæ¡†æ¶è§£æ:gin"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="æ–½å±•TIGERB"/>

    <!--Page Cover-->
    
        <meta property="og:image" content=""/>
    

    <!-- Title -->
    
    <title>Goæ¡†æ¶è§£æ:gin - æ–½å±•TIGERB</title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/sass/main.css">


    <!--[if lt IE 8]>
        
<script src="/js/ie/html5shiv.js"></script>

    <![endif]-->

    <!--[if lt IE 8]>
        
<link rel="stylesheet" href="/sass/ie8.css">

    <![endif]-->

    <!--[if lt IE 9]>
        
<link rel="stylesheet" href="/sass/ie9.css">

    <![endif]-->

    <!-- Gallery -->
    <link href="https://cdn.bootcss.com/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?30c7e7d53256334a8dc1cf524fcc77f6";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
    })();
    </script>

<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="æ–½å±•TIGERB" type="application/atom+xml">
</head>

<body>

    <div id="wrapper">

        <!-- Menu -->
        <!-- Header -->
<header id="header">
    <div class="inner">

        <!-- Logo -->
        <a href="/" class="logo">
            <span class="symbol"><img src="http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/20190707142019.png" alt="" /></span><span class="title">æ–½å±•TIGERB</span>
        </a>

        <!-- Nav -->
        <nav>
            <ul>
                <li><a href="#menu">Menu</a></li>
            </ul>
        </nav>

    </div>
</header>

<!-- Menu -->
<nav id="menu">
    <h2>Menu</h2>
    <ul>
        
            <li>
                <a href="/">é¦–é¡µ</a>
            </li>
        
            <li>
                <a target="_blank" rel="noopener" href="https://github.com/TIGERB">Github</a>
            </li>
        
            <li>
                <a target="_blank" rel="noopener" href="https://segmentfault.com/u/tigerb">Segmentfault</a>
            </li>
        
            <li>
                <a target="_blank" rel="noopener" href="https://juejin.im/user/5855e82d1b69e6006c9278b4">æ˜é‡‘</a>
            </li>
        
    </ul>
</nav>


        <div id="main">
            <div class="inner">

                <!-- Main Content -->
                

    <h1 class="title">Goæ¡†æ¶è§£æ:gin</h1>
    <div class="meta">
        2019-07-06
    </div>


    <span class="image main"><img src="No Code No Life" alt="" /></span>


<!-- Gallery -->


<!-- Content -->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/css/lightgallery.min.css" /><div class=".article-gallery"><a target="_blank" rel="noopener" href="http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/20190714104800.jpg" class="gallery-item"><img src="http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/20190714104800.jpg" style="width:100%"></a>

<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¤©æ˜¯æˆ‘golangæ¡†æ¶é˜…è¯»ç³»åˆ—ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼Œä»Šå¤©æˆ‘ä»¬ä¸»è¦çœ‹çœ‹<strong>gin</strong>çš„æ¡†æ¶æ‰§è¡Œæµç¨‹ã€‚å…³äº<strong>golangæ¡†æ¶ç”Ÿå‘½å‘¨æœŸ</strong>æºç é˜…è¯»ä¸‹é¢æ˜¯æˆ‘çš„è®¡åˆ’ï¼š</p>
<table>
<thead>
<tr>
<th>è®¡åˆ’</th>
<th>çŠ¶æ€</th>
</tr>
</thead>
<tbody><tr>
<td><a href="http://tigerb.cn/2018/12/06/go-beego/">Goæ¡†æ¶è§£æ:beego</a></td>
<td>âœ…done</td>
</tr>
<tr>
<td><a href="http://tigerb.cn/2019/06/29/go-iris/">Goæ¡†æ¶è§£æ:iris</a></td>
<td>âœ…done</td>
</tr>
<tr>
<td><a href="http://tigerb.cn/2019/07/06/go-gin/">Goæ¡†æ¶è§£æ:gin</a></td>
<td>âœ…done</td>
</tr>
<tr>
<td><a href="http://tigerb.cn/2019/07/13/go-echo/">Goæ¡†æ¶è§£æ:echo</a></td>
<td>âœ…done</td>
</tr>
<tr>
<td>Goæ¡†æ¶è§£æ:revel</td>
<td>âœˆï¸doing</td>
</tr>
<tr>
<td>Goæ¡†æ¶è§£æ:Martini</td>
<td>ï¸ï¸âœˆï¸doing</td>
</tr>
</tbody></table>
<p>å†å®Œæˆå„ä¸ªgolangæ¡†æ¶ç”Ÿå‘½å‘¨æœŸçš„è§£æä¹‹åï¼Œæˆ‘ä¼šè®¡åˆ’å¯¹è¿™å‡ ä¸ªæ¡†æ¶çš„ä¼˜ç•¥è¿›è¡Œä¸€ä¸ªç³»åˆ—åˆ†æï¼Œç”±äºä¸šå†…å¤§å¤šéƒ½æ˜¯æ€§èƒ½åˆ†æçš„æ¯”è¾ƒå¤šï¼Œæˆ‘å¯èƒ½ä¼šæ›´ä¾§é‡äºä»¥ä¸‹ç»´åº¦ï¼š</p>
<ul>
<li>æ¡†æ¶è®¾è®¡</li>
<li>è·¯ç”±ç®—æ³•</li>
</ul>
<p>ç¬¬ä¸€æ³¢æˆ‘ä»¬ä¸»è¦æŠŠé‡ç‚¹æ”¾åœ¨<strong>æ¡†æ¶è®¾è®¡</strong>ä¸Šé¢ã€‚</p>
<hr>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ä¸Šæ¬¡é˜…è¯»irisæˆ‘ä»¬ä½¿ç”¨çš„glideå®‰è£…çš„ï¼Œä»Šå¤©æˆ‘ä»¬å®‰è£…ginå°è¯•ä¸‹ä½¿ç”¨gomod,å…·ä½“æ­¥éª¤å¦‚ä¸‹ã€‚</p>
<p>ä½¿ç”¨go modå®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// åˆå§‹åŒ–go.modæ–‡ä»¶</span><br><span class="line">go mod init gin-code-read</span><br><span class="line">// å®‰è£…gin</span><br><span class="line">go get github.com/gin-gonic/gin</span><br><span class="line">// å¤åˆ¶ä¾èµ–åˆ°vendorç›®å½•</span><br><span class="line">go mod vendor</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨ä¸€ä¸ªç®€å•çš„gin httpæœåŠ¡ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">&quot;ping&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;pong&quot;</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸Šé¢çš„å¯åŠ¨ä»£ç æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œå’Œiriså¾ˆåƒæ˜¯å§ï¼ŒåŒæ ·çš„<code>Default</code>æ–¹æ³•ã€‚</p>
<hr>
<h2 id="ginçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ginçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ginçš„ç”Ÿå‘½å‘¨æœŸ"></a>ginçš„ç”Ÿå‘½å‘¨æœŸ</h2><p>çœ‹å®Œginæ¡†æ¶æµç¨‹æˆ‘æœ‰å¤§è‡´å¦‚ä¸‹å‡ ä¸ªæ„Ÿè§¦ï¼š</p>
<ul>
<li>ginæ˜¯æˆ‘ç›®å‰çœ‹è¿‡çš„è¿™ä¸‰ä¸ªgoæ¡†æ¶é‡Œæœ€ç®€æ´çš„æ¡†æ¶</li>
<li>ginå’Œirisåœ¨æ¡†æ¶è®¾è®¡å­˜åœ¨é£æ ¼ä¸€è‡´çš„åœ°æ–¹ï¼Œä¾‹å¦‚æ³¨å†Œä¸­é—´ä»¶ã€handleçš„æ‰§è¡Œ</li>
</ul>
<p>æ€»ä¹‹ï¼Œç›®å‰å°±ä¸€ä¸ªæ„Ÿå—ï¼š</p>
<blockquote>
<p>Ginæ˜¯æˆ‘è®¤ä¸ºçš„ä¸€ä¸ªGOæ¡†æ¶åº”è¯¥æœ‰çš„æ ·å­</p>
</blockquote>
<p>ä¸‹å›¾å°±æ˜¯æˆ‘å¯¹æ•´ä¸ªGinæ¡†æ¶ç”Ÿå‘½å‘¨æœŸçš„è¾“å‡ºï¼Œç”±äºå›¾ç‰‡è¿‡å¤§å­˜åœ¨å¹³å°å‹ç¼©çš„å¯èƒ½ï¼Œå»ºè®®å¤§å®¶ç›´æ¥æŸ¥çœ‹åŸå›¾é“¾æ¥ã€‚</p>
<a target="_blank" rel="noopener" href="http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/20190704211526.png" class="gallery-item"><img src="http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/20190704211526.png" style="width:100%"></a>

<blockquote>
<p>è®¿é—®å›¾ç‰‡æºåœ°å€æŸ¥çœ‹å¤§å›¾ <a target="_blank" rel="noopener" href="http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/20190704211526.png">http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/20190704211526.png</a></p>
</blockquote>
<p>åŸå›¾æŸ¥çœ‹é“¾æ¥: <a target="_blank" rel="noopener" href="http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/20190704211526.png">http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/20190704211526.png</a></p>
<hr>
<h2 id="å…³é”®ä»£ç è§£æ"><a href="#å…³é”®ä»£ç è§£æ" class="headerlink" title="å…³é”®ä»£ç è§£æ"></a>å…³é”®ä»£ç è§£æ</h2><!-- <a target="_blank" rel="noopener" href="http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/20190706205806.svg" class="gallery-item"><img src="http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/20190706205806.svg" width="100%"></a> -->

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–ä¸€ä¸ªginæ¡†æ¶å®ä¾‹</span></span><br><span class="line">gin.Default()</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="comment">// å…·ä½“çš„Defaultæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Default</span><span class="params">()</span></span> *Engine &#123;</span><br><span class="line">	<span class="comment">// è°ƒè¯•æ¨¡å¼æ—¥å¿—è¾“å‡º </span></span><br><span class="line">	<span class="comment">// ğŸŒŸå¾ˆä¸é”™çš„è®¾è®¡</span></span><br><span class="line">	debugPrintWARNINGDefault()</span><br><span class="line">	<span class="comment">// åˆ›å»ºä¸€ä¸ªginæ¡†æ¶å®ä¾‹</span></span><br><span class="line">	engine := New()</span><br><span class="line">	<span class="comment">// æ˜¯ä¸æ˜¯å¾ˆçœ¼ç†Ÿ å’Œirisé‡Œæ³¨å†Œä¸­é—´ä»¶çš„æ–¹å¼ä¸€è‡´</span></span><br><span class="line">	<span class="comment">// ä¸è¿‡æ¯”iriså¥½çš„æ˜¯æ”¯æŒå¤šå‚æ•° irisåˆ™æ˜¯å¾—è°ƒç”¨å¤šæ¬¡</span></span><br><span class="line">	engine.Use(Logger(), Recovery())</span><br><span class="line">	<span class="keyword">return</span> engine</span><br><span class="line">&#125;</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªginæ¡†æ¶å®ä¾‹ å…·ä½“æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">()</span></span> *Engine &#123;</span><br><span class="line">	<span class="comment">// è°ƒè¯•æ¨¡å¼æ—¥å¿—è¾“å‡º </span></span><br><span class="line">	debugPrintWARNINGNew()</span><br><span class="line">	<span class="comment">// å…ˆæ’å…¥ä¸€ä¸ªå°è¯é¢˜ï¼Œå¯èƒ½å¥½å¤šäººéƒ½åœ¨æƒ³ä¸ºä»€ä¹ˆå«ginå‘¢ï¼Ÿ</span></span><br><span class="line">	<span class="comment">// å“ˆå“ˆï¼Œè¿™ä¸ªæ¡†æ¶å®ä¾‹çš„ç»“æ„ä½“å®é™…å‘½åçš„Engine, å¾ˆæ˜æ˜¾ginå°±æ˜¯ä¸€ä¸ªå¾ˆä¸ªæ€§çš„ç®€ç§°äº†ï¼Œæ˜¯ä¸æ˜¯çœŸç›¸å¤§ç™½äº†ã€‚</span></span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–ä¸€ä¸ªEngineå®ä¾‹</span></span><br><span class="line">	engine := &amp;Engine&#123;</span><br><span class="line">		<span class="comment">// è·¯ç”±ç»„</span></span><br><span class="line">		<span class="comment">// ç»™æ¡†æ¶å®ä¾‹ç»‘å®šä¸Šä¸€ä¸ªè·¯ç”±ç»„</span></span><br><span class="line">		RouterGroup: RouterGroup&#123;</span><br><span class="line">			<span class="comment">// engine.Use æ³¨å†Œçš„ä¸­é—´æ–¹æ³•åˆ°è¿™é‡Œ</span></span><br><span class="line">			Handlers: <span class="literal">nil</span>,</span><br><span class="line">			basePath: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">			<span class="comment">// æ˜¯å¦æ˜¯è·¯ç”±æ ¹èŠ‚ç‚¹</span></span><br><span class="line">			root:     <span class="literal">true</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">		FuncMap:                template.FuncMap&#123;&#125;,</span><br><span class="line">		RedirectTrailingSlash:  <span class="literal">true</span>,</span><br><span class="line">		RedirectFixedPath:      <span class="literal">false</span>,</span><br><span class="line">		HandleMethodNotAllowed: <span class="literal">false</span>,</span><br><span class="line">		ForwardedByClientIP:    <span class="literal">true</span>,</span><br><span class="line">		AppEngine:              defaultAppEngine,</span><br><span class="line">		UseRawPath:             <span class="literal">false</span>,</span><br><span class="line">		UnescapePathValues:     <span class="literal">true</span>,</span><br><span class="line">		MaxMultipartMemory:     defaultMultipartMemory,</span><br><span class="line">		<span class="comment">// è·¯ç”±æ ‘</span></span><br><span class="line">		<span class="comment">// æˆ‘ä»¬çš„è·¯ç”±æœ€ç»ˆæ³¨å†Œåˆ°äº†è¿™é‡Œ</span></span><br><span class="line">		trees:                  <span class="built_in">make</span>(methodTrees, <span class="number">0</span>, <span class="number">9</span>),</span><br><span class="line">		delims:                 render.Delims&#123;Left: <span class="string">&quot;&#123;&#123;&quot;</span>, Right: <span class="string">&quot;&#125;&#125;&quot;</span>&#125;,</span><br><span class="line">		secureJsonPrefix:       <span class="string">&quot;while(1);&quot;</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// RouterGroupç»‘å®šengineè‡ªèº«çš„å®ä¾‹</span></span><br><span class="line">	<span class="comment">// ä¸å¤ªæ˜ç™½ä¸ºä½•å¦‚æ­¤è®¾è®¡</span></span><br><span class="line">	<span class="comment">// èŒè´£åˆ†æ˜ä¹ˆï¼Ÿ</span></span><br><span class="line">	engine.RouterGroup.engine = engine</span><br><span class="line">	<span class="comment">// ç»‘å®šä»å®ä¾‹æ± è·å–ä¸Šä¸‹æ–‡çš„é—­åŒ…æ–¹æ³•</span></span><br><span class="line">	engine.pool.New = <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">		<span class="comment">// è·å–ä¸€ä¸ªContextå®ä¾‹</span></span><br><span class="line">		<span class="keyword">return</span> engine.allocateContext()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// è¿”å›æ¡†æ¶å®ä¾‹</span></span><br><span class="line">	<span class="keyword">return</span> engine</span><br><span class="line">&#125;</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="comment">// æ³¨å†Œæ—¥å¿—&amp;goroutin panicæ•è·ä¸­é—´ä»¶</span></span><br><span class="line">engine.Use(Logger(), Recovery())</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="comment">// å…·ä½“çš„æ³¨å†Œä¸­é—´ä»¶çš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(engine *Engine)</span></span> Use(middleware ...HandlerFunc) IRoutes &#123;</span><br><span class="line">	engine.RouterGroup.Use(middleware...)</span><br><span class="line">	engine.rebuild404Handlers()</span><br><span class="line">	engine.rebuild405Handlers()</span><br><span class="line">	<span class="keyword">return</span> engine</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šé¢ æ˜¯ä¸€ä¸ªengineæ¡†æ¶å®ä¾‹åˆå§‹åŒ–çš„å…³é”®ä»£ç </span></span><br><span class="line"><span class="comment">// æˆ‘ä»¬åŸºæœ¬çœ‹å®Œäº†</span></span><br><span class="line"><span class="comment">// --------------router--------------</span></span><br><span class="line"><span class="comment">// æ¥ä¸‹æ¥ å¼€å§‹çœ‹è·¯ç”±æ³¨å†Œéƒ¨åˆ†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†ŒGETè¯·æ±‚è·¯ç”±</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(group *RouterGroup)</span></span> GET(relativePath <span class="type">string</span>, handlers ...HandlerFunc) IRoutes &#123;</span><br><span class="line">	<span class="comment">// å¾€è·¯ç”±ç»„å†… æ³¨å†ŒGETè¯·æ±‚è·¯ç”±</span></span><br><span class="line">	<span class="keyword">return</span> group.handle(<span class="string">&quot;GET&quot;</span>, relativePath, handlers)</span><br><span class="line">&#125;</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(group *RouterGroup)</span></span> handle(httpMethod, relativePath <span class="type">string</span>, handlers HandlersChain) IRoutes &#123;</span><br><span class="line">	absolutePath := group.calculateAbsolutePath(relativePath)</span><br><span class="line">	<span class="comment">// æŠŠä¸­é—´ä»¶çš„handleå’Œè¯¥è·¯ç”±çš„handleåˆå¹¶</span></span><br><span class="line">	handlers = group.combineHandlers(handlers)</span><br><span class="line">	<span class="comment">// æ³¨å†Œä¸€ä¸ªGETé›†åˆçš„è·¯ç”±</span></span><br><span class="line">	group.engine.addRoute(httpMethod, absolutePath, handlers)</span><br><span class="line">	<span class="keyword">return</span> group.returnObj()</span><br><span class="line">&#125;</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(engine *Engine)</span></span> addRoute(method, path <span class="type">string</span>, handlers HandlersChain) &#123;</span><br><span class="line">	assert1(path[<span class="number">0</span>] == <span class="string">&#x27;/&#x27;</span>, <span class="string">&quot;path must begin with &#x27;/&#x27;&quot;</span>)</span><br><span class="line">	assert1(method != <span class="string">&quot;&quot;</span>, <span class="string">&quot;HTTP method can not be empty&quot;</span>)</span><br><span class="line">	assert1(<span class="built_in">len</span>(handlers) &gt; <span class="number">0</span>, <span class="string">&quot;there must be at least one handler&quot;</span>)</span><br><span class="line"></span><br><span class="line">	debugPrintRoute(method, path, handlers)</span><br><span class="line">	<span class="comment">// æ£€æŸ¥æœ‰æ²¡æœ‰å¯¹åº”methodé›†åˆçš„è·¯ç”±</span></span><br><span class="line">	root := engine.trees.get(method)</span><br><span class="line">	<span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// æ²¡æœ‰ åˆ›å»ºä¸€ä¸ªæ–°çš„è·¯ç”±èŠ‚ç‚¹</span></span><br><span class="line">		root = <span class="built_in">new</span>(node)</span><br><span class="line">		<span class="comment">// æ·»åŠ è¯¥methodçš„è·¯ç”±treeåˆ°å½“å‰çš„è·¯ç”±åˆ°è·¯ç”±æ ‘é‡Œ</span></span><br><span class="line">		engine.trees = <span class="built_in">append</span>(engine.trees, methodTree&#123;method: method, root: root&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// æ·»åŠ è·¯ç”±</span></span><br><span class="line">	root.addRoute(path, handlers)</span><br><span class="line">&#125;</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="comment">// å¾ˆå…³é”®</span></span><br><span class="line"><span class="comment">// è·¯ç”±æ ‘èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">type</span> node <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// è·¯ç”±path</span></span><br><span class="line">	path      <span class="type">string</span></span><br><span class="line">	indices   <span class="type">string</span></span><br><span class="line">	<span class="comment">// å­è·¯ç”±èŠ‚ç‚¹</span></span><br><span class="line">	children  []*node</span><br><span class="line">	<span class="comment">// æ‰€æœ‰çš„handle æ„æˆä¸€ä¸ªé“¾</span></span><br><span class="line">	handlers  HandlersChain</span><br><span class="line">	priority  <span class="type">uint32</span></span><br><span class="line">	nType     nodeType</span><br><span class="line">	maxParams <span class="type">uint8</span></span><br><span class="line">	wildChild <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šé¢ </span></span><br><span class="line"><span class="comment">// æˆ‘ä»¬åŸºæœ¬çœ‹å®Œäº†</span></span><br><span class="line"><span class="comment">// --------------http server--------------</span></span><br><span class="line"><span class="comment">// æ¥ä¸‹æ¥ å¼€å§‹çœ‹ginå¦‚ä½•å¯åŠ¨çš„http server</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(engine *Engine)</span></span> Run(addr ...<span class="type">string</span>) (err <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; debugPrintError(err) &#125;()</span><br><span class="line"></span><br><span class="line">	address := resolveAddress(addr)</span><br><span class="line">	debugPrint(<span class="string">&quot;Listening and serving HTTP on %s\n&quot;</span>, address)</span><br><span class="line">	<span class="comment">// æ‰§è¡ŒhttpåŒ…çš„ListenAndServeæ–¹æ³• å¯åŠ¨è·¯ç”±</span></span><br><span class="line">	<span class="comment">// engineå®ç°äº†http.Handleræ¥å£ æ‰€ä»¥åœ¨è¿™é‡Œä½œä¸ºå‚æ•°ä¼ å‚è¿›å»</span></span><br><span class="line">	<span class="comment">// åé¢æˆ‘ä»¬å†çœ‹engine.ServeHTTPçš„å…·ä½“é€»è¾‘</span></span><br><span class="line">	err = http.ListenAndServe(address, engine)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="comment">// engineè‡ªèº«å°±å®ç°äº†Handleræ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Handler <span class="keyword">interface</span> &#123;</span><br><span class="line">	ServeHTTP(ResponseWriter, *Request)</span><br><span class="line">&#125;</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="comment">// ä¸‹é¢å°±æ˜¯ç½‘ç»œç›¸å…³äº†</span></span><br><span class="line"><span class="comment">// ç›‘å¬IP+ç«¯å£</span></span><br><span class="line">ln, err := net.Listen(<span class="string">&quot;tcp&quot;</span>, addr)</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="comment">// ä¸Šé¢æ‰§è¡Œå®Œäº†ç›‘å¬</span></span><br><span class="line"><span class="comment">// æ¥ç€å°±æ˜¯Serve</span></span><br><span class="line">srv.Serve(tcpKeepAliveListener&#123;ln.(*net.TCPListener)&#125;)</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="comment">// Acceptè¯·æ±‚</span></span><br><span class="line">rw, e := l.Accept()</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="comment">// ä½¿ç”¨goroutineå»å¤„ç†ä¸€ä¸ªè¯·æ±‚</span></span><br><span class="line"><span class="comment">// æœ€ç»ˆå°±æ‰§è¡Œçš„æ˜¯engineçš„ServeHTTPæ–¹æ³•</span></span><br><span class="line"><span class="keyword">go</span> c.serve(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šé¢æœåŠ¡å·²ç»å¯åŠ¨èµ·æ¥äº†</span></span><br><span class="line"><span class="comment">// --------------handle request--------------</span></span><br><span class="line"><span class="comment">// æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹engineçš„ServeHTTPæ–¹æ³•çš„å…·ä½“å†…å®¹</span></span><br><span class="line"><span class="comment">// engineå®ç°http.Handleræ¥å£ServeHTTPçš„å…·ä½“æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(engine *Engine)</span></span> ServeHTTP(w http.ResponseWriter, req *http.Request) &#123;</span><br><span class="line">	<span class="comment">// è·å–ä¸€ä¸ªä¸Šä¸‹æ–‡å®ä¾‹</span></span><br><span class="line">	<span class="comment">// ä»å®ä¾‹æ± è·å– æ€§èƒ½é«˜</span></span><br><span class="line">	c := engine.pool.Get().(*Context)</span><br><span class="line">	<span class="comment">// é‡ç½®è·å–åˆ°çš„ä¸Šä¸‹æ–‡å®ä¾‹çš„http.ResponseWriter</span></span><br><span class="line">	c.writermem.reset(w)</span><br><span class="line">	<span class="comment">// é‡ç½®è·å–åˆ°çš„ä¸Šä¸‹æ–‡å®ä¾‹*http.Request</span></span><br><span class="line">	c.Request = req</span><br><span class="line">	<span class="comment">// é‡ç½®è·å–åˆ°çš„ä¸Šä¸‹æ–‡å®ä¾‹çš„å…¶ä»–å±æ€§</span></span><br><span class="line">	c.reset()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å®é™…å¤„ç†è¯·æ±‚çš„åœ°æ–¹</span></span><br><span class="line">	<span class="comment">// ä¼ é€’å½“å‰çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line">	engine.handleHTTPRequest(c)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//å½’è¿˜ä¸Šä¸‹æ–‡å®ä¾‹</span></span><br><span class="line">	engine.pool.Put(c)</span><br><span class="line">&#125;</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="comment">// å…·ä½“æ‰§è¡Œè·¯ç”±çš„æ–¹æ³•</span></span><br><span class="line">engine.handleHTTPRequest(c)</span><br><span class="line">â¬‡ï¸</span><br><span class="line">t := engine.trees</span><br><span class="line"><span class="keyword">for</span> i, tl := <span class="number">0</span>, <span class="built_in">len</span>(t); i &lt; tl; i++ &#123;</span><br><span class="line">	<span class="comment">// è¿™é‡Œå¯»æ‰¾å½“å‰è¯·æ±‚methodçš„è·¯ç”±æ ‘èŠ‚ç‚¹</span></span><br><span class="line">	<span class="comment">// æˆ‘åœ¨æƒ³è¿™é‡Œä¸ºå•¥ä¸ç”¨mapå‘¢ï¼Ÿ</span></span><br><span class="line">	<span class="comment">// è™½è¯´ä¹Ÿéå†ä¸äº†å‡ æ¬¡</span></span><br><span class="line">	<span class="keyword">if</span> t[i].method != httpMethod &#123;</span><br><span class="line">		<span class="keyword">continue</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// æ‰¾åˆ°èŠ‚ç‚¹</span></span><br><span class="line">	root := t[i].root</span><br><span class="line">	<span class="comment">// å¾ˆå…³é”®çš„åœ°æ–¹</span></span><br><span class="line">	<span class="comment">// å¯»æ‰¾å½“å‰è¯·æ±‚çš„è·¯ç”±</span></span><br><span class="line">	handlers, params, tsr := root.getValue(path, c.Params, unescape)</span><br><span class="line">	<span class="keyword">if</span> handlers != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// æŠŠæ‰¾åˆ°çš„handlesèµ‹å€¼ç»™ä¸Šä¸‹æ–‡</span></span><br><span class="line">		c.handlers = handlers</span><br><span class="line">		<span class="comment">// æŠŠæ‰¾åˆ°çš„å…¥å‚èµ‹å€¼ç»™ä¸Šä¸‹æ–‡</span></span><br><span class="line">		c.Params = params</span><br><span class="line">		<span class="comment">// æ‰§è¡Œhandle</span></span><br><span class="line">		c.Next()</span><br><span class="line">		<span class="comment">// å¤„ç†å“åº”å†…å®¹</span></span><br><span class="line">		c.writermem.WriteHeaderNow()</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•æ ‘ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> methodTree <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// HTTP Method</span></span><br><span class="line">	method <span class="type">string</span></span><br><span class="line">	<span class="comment">// å½“å‰HTTP Methodçš„è·¯ç”±èŠ‚ç‚¹</span></span><br><span class="line">	root   *node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•æ ‘é›†åˆ</span></span><br><span class="line"><span class="keyword">type</span> methodTrees []methodTree</span><br><span class="line">â¬‡ï¸</span><br><span class="line"><span class="comment">// æ‰§è¡Œhandle</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span></span> Next() &#123;</span><br><span class="line">	<span class="comment">// ä¸Šä¸‹æ–‡å¤„ç†ä¹‹åc.indexè¢«æ‰§ä¸º-1</span></span><br><span class="line">	c.index++</span><br><span class="line">	<span class="keyword">for</span> s := <span class="type">int8</span>(<span class="built_in">len</span>(c.handlers)); c.index &lt; s; c.index++ &#123;</span><br><span class="line">		<span class="comment">// éå†æ‰§è¡Œæ‰€æœ‰handle(å…¶å®å°±æ˜¯ä¸­é—´ä»¶+è·¯ç”±handle)</span></span><br><span class="line">		<span class="comment">// é¦–å…ˆæ„Ÿè§‰è¿™é‡Œçš„è®¾è®¡åˆæ˜¯ä¼¼æ›¾ç›¸è¯† irisä¸æ˜¯ä¹Ÿæ˜¯è¿™æ ·ä¹ˆ ä¸æ‡‚äº† å“ˆå“ˆ</span></span><br><span class="line">		<span class="comment">// å…¶æ¬¡æ„Ÿè§‰è¿™é‡Œè®¾è®¡çš„å¾ˆä¸€èˆ¬ éå†ï¼Ÿå¤šæ— èŠï¼Œè¿™é‡Œå¤šä¹ˆé€‚åˆã€Œè´£ä»»é“¾æ¨¡å¼ã€</span></span><br><span class="line">		<span class="comment">// ä¹‹åç»™å¤§å®¶å¸¦æ¥å…³äºè¿™ä¸ªhandleæ‰§è¡Œçš„ã€Œè´£ä»»é“¾æ¨¡å¼ã€çš„è®¾è®¡</span></span><br><span class="line">		c.handlers[c.index](c)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Contextçš„é‡ç½®æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span></span> reset() &#123;</span><br><span class="line">	c.Writer = &amp;c.writermem</span><br><span class="line">	c.Params = c.Params[<span class="number">0</span>:<span class="number">0</span>]</span><br><span class="line">	c.handlers = <span class="literal">nil</span></span><br><span class="line">	<span class="comment">// å¾ˆå…³é”® æ³¨æ„è¿™é‡Œæ˜¯-1å“¦</span></span><br><span class="line">	c.index = <span class="number">-1</span></span><br><span class="line">	c.Keys = <span class="literal">nil</span></span><br><span class="line">	c.Errors = c.Errors[<span class="number">0</span>:<span class="number">0</span>]</span><br><span class="line">	c.Accepted = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æœ€åæˆ‘ä»¬å†ç®€å•çš„å›é¡¾ä¸‹ä¸Šé¢çš„æµç¨‹,ä»ä¸‹å›¾çœ‹æ¥ï¼Œæ˜¯ä¸æ˜¯ç›¸å¯¹äºirisç®€å•äº†å¥½å¤šã€‚</p>
<p align="center">
    <a target="_blank" rel="noopener" href="http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/20190706222632.png" class="gallery-item"><img src="http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/20190706222632.png" style="width:30%"></a>
</p>

<hr>
<p>ã€ŠGoæ¡†æ¶è§£æã€‹ç³»åˆ—æ–‡ç« é“¾æ¥å¦‚ä¸‹ï¼š</p>
<ul>
<li><a href="http://tigerb.cn/2019/07/13/go-echo/">Goæ¡†æ¶è§£æ:echo</a></li>
<li><a href="http://tigerb.cn/2019/07/06/go-gin/">Goæ¡†æ¶è§£æ:gin</a></li>
<li><a href="http://tigerb.cn/2019/06/29/go-iris/">Goæ¡†æ¶è§£æ:iris</a></li>
<li><a href="http://tigerb.cn/2018/12/06/go-beego/">Goæ¡†æ¶è§£æ:beego</a></li>
</ul>
</div><script src="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/js/lightgallery.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script>

<!-- Tags -->



<div class="tags">
    <a href="/tags/golang/" class="button small">golang</a>
</div>



<!-- Qrcode -->
<div width="100px">
    <img src="https://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/wechat-blog-qrcode.jpg" alt="TIGERB" width="300px" style="display:block; margin: 30px auto 0px auto;">
</div>

<!-- Comments -->
<div>
    


</div>



            </div>
        </div>

        <!-- Footer -->
<footer id="footer">
    <div class="inner">
        <section>
            <h2>About</h2>
            <div>
                æ–°ä¸€ä»£è½»é‡çº§ã€Œ<a target="_blank" rel="noopener" href='http://easy-php.tigerb.cn'>EasyPHP</a>ã€æ¡†æ¶ä½œè€…ï¼Œ<a href="/php2go/#/">ã€Œã€ŠPHPåˆ°Goé€Ÿè½¬æ‰‹å†Œã€‹ã€ä½œè€…</a>ï¼Œã€Œ<a target="_blank" rel="noopener" href='http://skrshop.tech/'>ã€Šç”µå•†è®¾è®¡æ‰‹å†Œ | SkrShopã€‹</a>ã€ä½œè€…ï¼Œã€Œ<a href='http://tigerb.cn/go/#/patterns/'>ã€ŠGoè®¾è®¡æ¨¡å¼å®æˆ˜ã€‹ç³»åˆ—</a>ã€ä½œè€…ï¼Œã€Œ<a href='http://tigerb.cn/go/#/kernal/'>ã€ŠGoè¯­è¨€è½»æ¾è¿›é˜¶ã€‹ç³»åˆ—</a>ã€ä½œè€…ã€‚ç°ä¸–ç•Œ500å¼ºæŠ€æœ¯ç»ç†ï¼Œæ‹¥æœ‰ä¸°å¯Œçš„æ¶æ„ã€ç”µå•†ç³»ç»Ÿè®¾è®¡ã€é«˜å¹¶å‘ã€ä½“ç³»æµç¨‹å»ºè®¾å’Œç®¡ç†ç»éªŒã€‚<br><br><img style="vertical-align:middle" width="30%" src="http://blog-1251019962.cos.ap-beijing.myqcloud.com/qiniu_img_2022/wechat-blog-qrcode.jpg?imageMogr2/thumbnail/260x260!/format/webp/blur/1x0/quality/90|imageslim">
            </div>
        </section>
        <section>
            <h2>Follow</h2>
            <ul class="icons">
                
                    <li><a href="https://twitter.com/CODERCOOKER" class="icon style2 fa-twitter" target="_blank" ><span class="label">Twitter</span></a></li>
                
                
                
                
                
                    <li><a href="https://github.com/TIGERB" class="icon style2 fa-github" target="_blank" ><span class="label">GitHub</span></a></li>
                
                
                
                
                
                    <li><a href="mailto:tigerbcode@gmail.com" class="icon style2 fa-envelope-o" target="_blank" ><span class="label">Email</span></a></li>
                
                
                    <li><a href="\atom.xml" class="icon style2 fa-rss" target="_blank" ><span class="label">RSS</span></a></li>
                
            </ul>
        </section>
        <ul class="copyright">
            <li>&copy; TIGERB.cn All right reserved. æ´¥ICPå¤‡17006784å·-2</li>
            <li><a href="https://juejin.im/user/5855e82d1b69e6006c9278b4" target="_blank">juejin</a></li>
            <li><a href="https://segmentfault.com/u/tigerb" target="_blank">Segmentfault</a></li>
            <li><a target="_blank" rel="noopener" href="http://skrshop.tech/">ç”µå•†è®¾è®¡æ‰‹å†Œ | SkrShop</a></li>
            <li><a href="http://tigerb.cn/go/#/patterns/">Goè®¾è®¡æ¨¡å¼å®æˆ˜</a></li>
            <li><a href="http://tigerb.cn/go/#/kernal/">Goè¯­è¨€è½»æ¾è¿›é˜¶</a></li>
            <li><a target="_blank" rel="noopener" href="https://dayutalk.cn/">å¤§æ„šTalk</a></li>
        </ul>
    </div>
</footer>
    </div>

    <!-- After footer scripts -->
    
<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- skel -->

<script src="/js/skel.min.js"></script>


<!-- Custom Code -->

<script src="/js/util.js"></script>


<!--[if lte IE 8]>

<script src="/js/ie/respond.min.js"></script>

<![endif]-->

<!-- Custom Code -->

<script src="/js/main.js"></script>


<!-- Gallery -->
<script src="https://cdn.bootcss.com/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->


</body>

</html>